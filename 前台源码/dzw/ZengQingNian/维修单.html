<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>维修单</title>
		<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" />
		<style type="text/css">
			iframe {
				height: 900px;
				width: 100%;
				border: 0px;
			}
			
			form {
				color: #269ABC;
			}
			html {
				-ms-overflow-style:none;
				overflow:-moz-scrollbars-none;
				}
			html::-webkit-scrollbar{width:0px}
		</style>
	</head>
	<body>
		<div id="ctn" class="container-fluid">
			<div class="row" style="background-color: rgb(247,255,255);display: flex; align-items: center;height: 50px;">
				<span style="font-size: 25px;margin-left: 20px;">维修单</span>
				<button class="btn" style="margin-left: 89%;">取消</button>
			</div>
			<div class="row" style="background-color: rgb(247,247,247);height: 40px;display: flex;align-items: center;">
				<span style="font-size: 17px;margin-left: 20px;">单号：{{addServicing.serNumber}}</span>
				<button style="margin-left: 80.6%;" type="button" class="btn btn-success"v-if="setButtonStatus1" @click="takeCarFinish">接车完成</button>
				<button style="margin-left: 80.6%;" type="button" class="btn btn-success" v-if="setButtonStatus2"@click="testOnCompletion">竣工检验</button>
				<button style="margin-left: 80.6%;" type="button" class="btn btn-success" v-if="setButtonStatus3"@click="settlement">结算</button>
			</div>
			<div class="row" style="border-top: 1px solid rgb(33,182,206);">
				<form class="form-inline" style="margin-top: 10px;">
					<div style="margin-bottom: 10px;">
						<div class="form-group" style="margin-left: 30px;">
							车牌号码 <input type="text" class="form-control" id="exampleInputName1" v-model="addServicing.serChepai" readonly="readonly">
						</div>
						<div class="form-group">
							车架号
							<input type="text" class="form-control" id="exampleInputName2" v-model="addServicing.serChejia" readonly="readonly">
						</div>
						<div class="form-group">
							车辆型号
							<input type="text" class="form-control" id="exampleInputName3" v-model="addServicing.serChexinghao" readonly="readonly">
						</div>
						<div class="form-group">
							车辆品牌
							<input type="text" class="form-control" id="exampleInputName4" v-model="addServicing.serCarbrand" readonly="readonly">
						</div>
					</div>
					
					<div style="margin-bottom: 10px;">
						<div class="form-group" style="margin-left: 30px;">
							发动机号
							<input type="text" class="form-control" id="exampleInputName5" v-model="addServicing.serMotornumber" readonly="readonly">
						</div>
						<div class="form-group">
							发动机品牌
							<input type="text" class="form-control" id="exampleInputName6" v-model="addServicing.serMotorbrand" readonly="readonly">
						</div>
						<div class="form-group">
							服务顾问
							<input type="text" class="form-control" id="exampleInputName7" v-model="addServicing.serServiceguwen" :readonly="billsTrue?false:'readonly'">
						</div>
					</div>
					
					<div style="margin-bottom: 10px;">
						<div class="form-group" style="margin-left: 30px;">
							车主姓名
							<input type="text" class="form-control" id="exampleInputName8" v-model="addServicing.serCarzhuname" readonly="readonly">
						</div>
						<div class="form-group">
							驾驶员
							<input type="text" class="form-control" id="exampleInputName9" v-model="addServicing.serDriver" readonly="readonly">
						</div>
						<div class="form-group">
							联系电话
							<input type="text" class="form-control" id="exampleInputName10" v-model="addServicing.serLianxiphone" readonly="readonly">
						</div>
					</div>
					
					<div style="margin-bottom: 10px;">
						<div class="form-group" style="margin-left: 30px;">
							进厂里程
							<input type="text" class="form-control" id="exampleInputName11" v-model="addServicing.serJinchanglicheng" :readonly="billsTrue?false:'readonly'">
						</div>
						<div class="form-group">
							进厂油量
							<input type="text" class="form-control" id="exampleInputName12" v-model="addServicing.serJinchangyl" :readonly="billsTrue?false:'readonly'">
						</div>
						<div class="form-group">
							上次里程
							<input type="text" class="form-control" id="exampleInputName13" v-model="addServicing.serShangcilicheng" readonly="readonly">
						</div>
						<div class="form-group">
							进厂时间
							<input type="text" class="form-control" id="exampleInputName14" v-model="addServicing.serJctime" :readonly="billsTrue?false:'readonly'">
						</div>
					</div>
					
					<div style="margin-bottom: 10px;">
						<div class="form-group" style="margin-left: 30px;">
							业务类别
							<input type="text" class="form-control" id="exampleInputName15" v-model="addServicing.serServietype" :readonly="billsTrue?false:'readonly'">
						</div>
						<div class="form-group">
							施工班次
							<input type="text" class="form-control" id="exampleInputName16" v-model="addServicing.serSgbanci" :readonly="billsTrue?false:'readonly'">
						</div>
						<div class="form-group">
							接车人
							<input type="text" class="form-control" id="exampleInputName17" v-model="addServicing.serJiecaruser" :readonly="billsTrue?false:'readonly'">
						</div>
						<div class="form-group">
							预计完工
							<input type="text" class="form-control" id="exampleInputName18" v-model="addServicing.serExpecttime" :readonly="billsTrue?false:'readonly'">
						</div>
					</div>
					
					<div style="margin-bottom: 10px;">
						<div class="form-group" style="margin-left: 30px;">
							结算方式
							<input type="text" class="form-control" id="exampleInputName19" v-model="addServicing.serJsfangshi" :readonly="billsTrue?false:'readonly'">
						</div>
						<div class="form-group">
							赔款公司
							<input type="text" class="form-control" id="exampleInputName20" v-model="addServicing.serPeikuan" :readonly="billsTrue?false:'readonly'">
						</div>
						<div class="form-group">
							完工时间
							<input type="text" class="form-control" id="exampleInputName21" v-model="addServicing.serSgtime" :readonly="billsTrue?false:'readonly'">
						</div>
						<div class="form-group">
							上次进厂
							<input type="text" class="form-control" id="exampleInputName22" v-model="addServicing.serScjinchang" readonly="readonly">
						</div>
					</div>
					
					<div style="margin-bottom: 10px;">
						<div class="form-group" style="margin-left: 30px;">
							预估金额
							<input type="text" class="form-control" id="exampleInputName23" v-model="addServicing.serExpectmoney" :readonly="billsTrue?false:'readonly'">
						</div>
						<div class="form-group">
							接待备注
							<input type="text" style="width: 694px;" class="form-control" id="exampleInputName24" v-model="addServicing.serJdbeizu" :readonly="billsTrue?false:'readonly'">
						</div>
					</div>
					
					<div class="form-group" style="margin-left: 30px;">
						报修陈述
						<textarea rows="" cols="127" class="form-control" :readonly="billsTrue?false:'readonly'">

							</textarea>
					</div>
				</form>
			</div>
			<div class="row">
				<div class="col-md-12">
					<ul class="nav nav-tabs">
						<li :class="{active:item.active}" v-for="item in tabs"><a :href="'#'+item.ename" data-toggle="tab" @click="activeBool(item)">{{item.name}}</a></li>
					</ul>
				</div>
			</div>
			<div class="row" style="display: flex; background-color:rgb(239,247,255);height: 36px;align-items: center;" v-if="wxVisble">
				<div class="col-md-3" style="display: flex;justify-content: center;align-items: center;justify-content: space-around;">
					<a href="##" @click="wxModalShow(0)">单个增加</a>
					<a href="##" @click="wxModalShow1(1)">多个增加</a>
					<a href="##">修改</a>
					<a href="##">删除</a>
				</div>
			</div>
			<div class="row" style="display: flex; background-color:rgb(239,247,255);height: 36px;align-items: center;" v-if="llVisble">
				<div class="col-md-3" style="display: flex;justify-content: center;align-items: center;justify-content: space-around;">
					<a href="##" @click="llModalShow">单个增加</a>
					<a href="##">多个增加</a>
					<a href="##">修改</a>
					<a href="##">删除</a>
				</div>
			</div>
			<div class="row">
				<div class="tab-content">
					<div v-for="item in tabs" :id="item.ename" :class="['tab-pane',item.active?'active':'']">
						<iframe :src="item.path"></iframe>
					</div>
				</div>
			</div>



			<!--维修项目模态框-->
			<div class="modal fade" id="wxMoal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
				<div class="modal-dialog" role="document">

					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
							<span class="modal-title" style="font-size: 20px;"><strong>维修项目</strong></span>
							<button style="margin-left: 70%;" class="btn btn-success" @click="saveWxProject">保存</button>
						</div>
						<div class="modal-body" style="background-color: rgb(247,247,247);">
							<form class="form-horizontal">
							  <div class="form-group">
							    <label for="inputEmail3" class="col-sm-2 control-label">维修项目</label>
									<div class="col-sm-8">
									  <input type="text" class="form-control" id="inputPassword3" v-model="serproject.wxProjectnae">
									</div>
									<button class="btn btn-success" style="margin-left: 30px;" @click="xzWeiXiu()">选择</button>
							  </div>
							  <div class="form-group">
							    <label for="inputPassword3" class="col-sm-2 control-label">价类</label>
							    <div class="col-sm-4">
							      <input type="text" class="form-control" id="inputPassword3" v-model="serproject.wxJialei">
							    </div>
									<label for="inputPassword3" class="col-sm-2 control-label">免单原因</label>
									<div class="col-sm-4">
									  <input type="text" class="form-control" id="inputPassword3" v-model="serproject.wxMiandan">
									</div>
							  </div>
								<div class="form-group">
								  <label for="inputPassword3" class="col-sm-2 control-label">服务顾问</label>
								  <div class="col-sm-3">
								    <input type="text" class="form-control" id="inputPassword3" v-model="serproject.wxServiceuser">
								  </div>
									<label for="inputPassword3" class="col-sm-3 control-label">技师结算标价</label>
									<div class="col-sm-3">
									  <input type="text" class="form-control" id="inputPassword3" v-model="serproject.wxJsjies">
									</div>
								</div>
								<div class="form-group">
								  <label for="inputPassword3" class="col-sm-2 control-label">数量</label>
								  <div class="col-sm-4">
								    <input type="text" class="form-control" id="inputPassword3" v-model="serproject.wxNumber">
								  </div>
									<label for="inputPassword3" class="col-sm-2 control-label">工时单价</label>
									<div class="col-sm-4">
									  <input type="text" class="form-control" id="inputPassword3" v-model="serproject.wxGsdanjia">
									</div>
								</div>
								<div class="form-group">
								  <label for="inputEmail3" class="col-sm-2 control-label">故障描述</label>
								  <div class="col-sm-10">
								    <input type="text" class="form-control" id="inputEmail3" v-model="serproject.wxGzmiaoshu">
								  </div>
								</div>
								<div class="form-group">
								  <label for="inputEmail3" class="col-sm-2 control-label">故障原因</label>
								  <div class="col-sm-10">
								    <input type="text" class="form-control" id="inputEmail3"  v-model="serproject.wxGzyuanyin">
								  </div>
								</div>
								<div class="form-group">
								  <label for="inputPassword3" class="col-sm-2 control-label">维修班组</label>
								  <div class="col-sm-4">
								    <input type="text" class="form-control" id="inputPassword3"  v-model="serproject.wxWeixiubz">
								  </div>
									<label for="inputPassword3" class="col-sm-2 control-label">工单号</label>
									<div class="col-sm-4">
									  <input type="text" class="form-control" id="inputPassword3"  v-model="serproject.wxGdannumber">
									</div>
								</div>
							</form>
						</div>
						<div class="modal-footer">

						</div>
					</div>

				</div>
			</div>
			<!--维修项目模态框2-->

			<div class="modal fade" id="wxdMoal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
				<!-- <div class="modal-dialog" role="document" style="width: 1200px;">
				  <div class="modal-content">
				   <div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
					<span class="modal-title" style="font-size: 20px;"><strong>物料需求</strong></span>
					<button style="margin-left: 71%;" class="btn btn-default">选择</button>
					<button style="margin-left: 10px;" class="btn btn-success">保存</button>
				   </div>
				   <div class="modal-body" style="background-color: rgb(247,247,247);height: 450px important;">
					<div class="modal-body " style="padding: 0px !important;">
						<div style="width: 100%; height: 580px;">
							<iframe src="../yf/maintain_pro.html" width="100%" height="100%"></iframe>
						</div>
			   >
					</div>
					
				   </div>
				   <div class="modal-footer">
				   </div>
				  </div>
			 
				 </div> -->
				<div class="modal-dialog modal-lg" role="document" style="width: 1200px;">
				 <div class="modal-content">
				  <div class="modal-header">
				   <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
					 aria-hidden="true">&times;</span></button>
				   <h4 class="modal-title clearfix" id="myModalLabel">供货单位
				   </h4>
				  </div>
				  <div class="modal-body " style="padding: 0px !important;">
				   <div style="width: 100%; height: 580px;">
					<iframe id="iframe" src="../yf/maintain_pro.html" width="100%" ref="iframe" height="100%"
					 frameborder="no" border="0" style="border: none;"></iframe>
					<!-- transform:scale(1.1,1.1) -->
				   </div>
				   <!-- <iframe src="supplier.html" frameborder="0" style="width: 100%;  height: 550px;"></iframe> -->
				  </div>
			 
				 </div>
				</div>
			   </div>   

			<!--领料模态框-->
			<div class="modal fade" id="llMoal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
				<div class="modal-dialog" role="document" style="width: 800px;">

					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
							<span class="modal-title" style="font-size: 20px;"><strong>物料需求</strong></span>
							<button style="margin-left: 71%;" class="btn btn-default">选择</button>
							<button style="margin-left: 10px;" class="btn btn-success">保存</button>
						</div>
						<div class="modal-body" style="background-color: rgb(247,247,247);">
							<form class="form-inline">
								<div>
									<div class="form-group">
									  <label for="exampleInputName2">商品编码</label>
										<input type="text" class="form-control" id="exampleInputName2" style="width: 150px;">
									</div>
									<div class="form-group">
									  <label for="exampleInputEmail2">商品名称</label>
									  <input type="text" class="form-control" id="exampleInputEmail2" style="width: 150px;">
									</div>
									<div class="form-group">
									  <label for="exampleInputEmail2">商品品牌</label>
									  <input type="text" class="form-control" id="exampleInputEmail2" style="width: 150px;"	>
									</div>
								</div>
							  
								<div style="margin-top: 8px;">
									<div class="form-group">
									  <label for="exampleInputName2">适用车型</label>
										<input type="text" class="form-control" id="exampleInputName2" style="width: 150px;">
									</div>
									<div class="form-group">
									  <label for="exampleInputEmail2">单位</label>
									  <input type="text" class="form-control" id="exampleInputEmail2" style="width: 150px;">
									</div>
									<div class="form-group">
										<label for="exampleInputEmail2">价类</label>
										<select name=""  class="form-control" style="width: 120px;">
											<option value=""></option>
										</select>
									</div>
									<div class="form-group">
										<label for="exampleInputEmail2">仓库</label>
										<select name="" class="form-control" style="width: 120px;">
											<option value=""></option>
										</select>
									</div>
									
									<div style="margin-top: 8px;">
										<div class="form-group">
											<label for="exampleInputEmail2">免单原因</label>
											<select name="" class="form-control" style="width: 150px;">
												<option value=""></option>
											</select>
										</div>
										<div class="form-group">
										  <label for="exampleInputEmail2">单价</label>
										  <input type="text" class="form-control" id="exampleInputEmail2" style="width: 150px;">
										</div>
										<div class="form-group">
										  <label for="exampleInputEmail2">需求数量</label>
										  <input type="text" class="form-control" id="exampleInputEmail2" style="width: 150px;">
										</div>
									</div>
								
									<div style="margin-top: 8px;">
										<div class="form-group">
											<label for="exampleInputEmail2">对应项目</label>
											<select name="" class="form-control" style="width: 490px;">
												<option value=""></option>
											</select>
										</div>
										<div class="form-group">
										  <label for="exampleInputEmail2">可用库存</label>
										  <input type="text" class="form-control" id="exampleInputEmail2" style="width: 150px;">
										</div>
									</div>
								</div>
								
								
							</form>
							
						</div>
						<div class="modal-footer">
							
						</div>
					</div>

				</div>
			</div>
			
			
		
			
		</div>
		<script type="text/javascript" src="js/jquery-1.12.4.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/vue-2.6.js"></script>
		<script type="text/javascript">
			new Vue({
				el: "#ctn",
				data() {
					return {
						modalIndex: 0,
						iframCheckbox: false,
						tabs: [{
							id: 0,
							name: "维修项目",
							ename: "weixiu",
							active: false,
							path: "pages/weixiu.html"
						}, {
							id: 1,
							name: "领料情况",
							ename: "lingliao",
							active: false,
							path: "pages/ll.html"
						}, {
							id: 2,
							name: "结算信息",
							ename: "jies",
							active: false,
							path: "pages/jiesuan.html"
						}],
						//管理增删改得显示隐藏
						llVisble: false,
						wxVisble: false,
						//新增的维修单
						addServicing:{
							serChepai:"",
							serNumber:"",
							serScjinchang:"",
							serShangcilicheng:"",
							serChejia:"",
							serChexinhao:"",
							serCarbrand:"",
							serMotornumber:"",
							serMotorbrand:"",
							serDriver:"",
							serCarzhuname:"",
							serLianxiphone:"",
							serServiceguwen:"",
							serJinchanglicheng:"",
							serJinchangyl:"",
							serJctime:"",
							serServietype:"",
							serSgbanci:"",
							serJiecaruser:"",
							serExpecttime:"",
							serJsfangshi:"",
							serPeikuan:"",
							serSgtime:"",
							serExpectmoney:"",
							serJdbeizu:"",
							//关闭模态框标识,告知维修接车页面关闭模态框
							closeLogin:true,
							//根据单号查询到的维修项目list
							ServicingProjectList:[]
						},
						//判断是否是打开单据
						billsTrue:true,
						//新增得单个维修项目
						iframeVue:{},
						//所有班组
						teamForm:{},
						//单个维修项目
						serproject:{wxProjectnae:""},
						//多个维修项目
						sjList:[],
						//维修项目路径
						url:"http://127.0.0.1:8080/servicingproject/",
						//接车按钮标识用于判断按钮名为接车完成、竣工检验、结算
						setButtonStatus1:false,
						setButtonStatus2:false,
						setButtonStatus3:false,
					}
				},
				mounted() {
					let that = this;
					window.addEventListener("message", function (e) {
						let iframeVue = JSON.parse(JSON.stringify(e.data));
						console.log(iframeVue);
						if(iframeVue.aa=="aa"){
							//维修接车传递的数据
							console.log(iframeVue);
							that.setButtonStatus1=false;
							that.setButtonStatus2=false;
							that.setButtonStatus3=false;
							that.addServicing.serChepai = iframeVue.val.chepai;
							that.addServicing.serChejia=iframeVue.val.chejia;
							that.addServicing.serChexinghao=iframeVue.val.chexinghao;
							that.addServicing.serCarbrand=iframeVue.val.carbrand;
							that.addServicing.serMotornumber=iframeVue.val.motornumber;
							that.addServicing.serCarzhuname=iframeVue.val.carzhuname;
							that.addServicing.serDriver=iframeVue.val.driver;
							that.addServicing.serLianxiphone=iframeVue.val.lianxiphone;
							that.addServicing.serMotorbrand=iframeVue.val.motorbrand;
							that.addServicing.serNumber=iframeVue.val.serNumber;
							that.addServicing.setButtonStatus=iframeVue.val.setButtonStatus;
							console.log(that.addServicing);
							//根据单据状态显示按钮
							if(that.addServicing.setButtonStatus==0){
								that.setButtonStatus1=true;
								that.billsTrue=true;
							}else if(that.addServicing.setButtonStatus==1){
								that.setButtonStatus2=true;
								that.billsTrue=true;
							}else{
								that.setButtonStatus3=true;
								that.billsTrue=false;
							}
							that.selServicingById();
							that.selCarLastRecordByChepai(that.addServicing.serChepai);
							that.selSumPrice();
							console.log(that);
							/* if(that.addServicing.serNumber!=null){
								that.selServicingById();
								that.billsTrue=false;
							}else{
								that.selCarLastRecordByChepai(that.addServicing.serChepai);
								that.billsTrue=true;
							} */
						} else if(iframeVue.aa=="bb"){
							if(that.modalIndex === 0){
								that.serproject.column1=iframeVue.code.seId;//项目号
								that.serproject.wxProjectnae = iframeVue.code.seName;//项目名称
								that.serproject.wxGdannumber=that.addServicing.serNumber;//工单号
								console.log(that.serproject);
								/* $("#wxdMoal").modal("hide");//关闭选择模态框 */
								that.selServicingProjectBySerNumber();
								that.selSumPrice();
							}else{
								that.sjList = iframeVue.code;
								console.log(that.sjList);
								//定义一个数组，里面存储维修项目对象
								var projectList=[];
								for(var i=0;i<that.sjList.length;i++){
										var project={};
										project.wxProjectnae=that.sjList[i].seName;
										project.wxNumber=1;
										project.wxGsdanjia = that.sjList[i].price;//工时单价
										project.wxJsjies = that.sjList[i].vipPrice;//技师结算单价
										project.wxJialei="自费";
										project.column1=that.sjList[i].seId;//项目号
										project.wxGdannumber=that.addServicing.serNumber;//工单号
										/* project.wxGdannumber="00000RE210200001";//工单号 */
										projectList.push(project);
									}
								console.log(projectList);
								var json=JSON.stringify(projectList);
								console.log(json);
								$.ajax({
									url:"http://127.0.0.1:8080/servicingproject/addProjectList",
									type:"post",
									data:json,
									xhrFields: {
										withCredentials: true
									},
									crossDomain: true,
									async:false,
									contentType:"application/json;charset=utf-8",
									success:function(result){
										if(result){
											alert("保存成功！")
										}else{
											alert("保存失败！")
										}
										/* location.reload(); */
									}
								});
								that.selServicingProjectBySerNumber();
								that.selSumPrice();
							}
							if(iframeVue)
							$("#wxdMoal").modal("hide");
						}
					});
				},
				methods: {
					//选择维修 0 单个 1 多个
					xzWeiXiu() {
						//像子页面传值
						this.modalIndex = 0;
						this.iframe = this.$refs.iframe
						this.iframeWindow = this.iframe.contentWindow;
						let message = [false, false];
						console.log(message);
						this.iframeWindow.postMessage(message, '*');
						$("#wxdMoal").modal("show");
					},
					//维修模态框得显示
					wxModalShow(index) {
						$("#iframe").get(0).contentWindow.location.reload(true);
						this.modalIndex = index;
						alert("222");
						$("#wxMoal").modal("show");
					},
					//维修多选框
					wxModalShow1(){
					$("#iframe").get(0).contentWindow.location.reload(true);
					setTimeout(()=>{
						this.modalIndex = 1;
						this.iframCheckbox = false;
						//像子页面传值
						this.iframe = this.$refs.iframe
						this.iframeWindow = this.iframe.contentWindow;
						let message= [false, true];
						console.log(message);
						this.iframeWindow.postMessage(message, '*');
						$("#wxdMoal").modal("show");
					},500)
				   
					},
					//领料模态框显示
					llModalShow(){
						$("#llMoal").modal("show");
					},
					//控制增删改得显示隐藏 
					activeBool(item) {
						if (item.ename === "weixiu") {
							this.wxVisble = true;
							this.llVisble = false;
						} else if (item.ename === "lingliao") {
							this.llVisble = true;
							this.wxVisble = false;
						}else{
							this.llVisble = false;
							this.wxVisble = false;
						}
					},
					//根据传过来的车牌查询出该车上次进厂的里程及进厂时间
					selCarLastRecordByChepai(chepai){
						/* alert(chepai); */
						let that=this;
						$.ajax({
							url:"http://127.0.0.1:8080/servicing/selCarLastRecordByChepai/"+chepai,
							dataType:"json",
							type:"get",
							xhrFields: {
								withCredentials: true
							},
							crossDomain: true,
							async:false,
							success:function(result){
								let servicing=result;
								console.log(servicing);
								that.addServicing.serShangcilicheng=servicing.serJinchanglicheng;
								that.addServicing.serScjinchang=servicing.serJctime;
								console.log(that.addServicing);
							}
						});
					},
					/* //自动获取维修单号
					getSerNumber(){
						let that=this;
						console.log(that);
						$.ajax({
							url:"http://127.0.0.1:8080/servicing/getServicingId",
							type:"get",
							xhrFields: {
								withCredentials: true
							},
							crossDomain: true,
							async:false,
							success:function(result){
								console.log(result);
								that.addServicing.serNumber=result;
							}
						});
					}, */
					//根据维修单号查询该维修单相关信息
					selServicingById(){
						let serNumber=this.addServicing.serNumber;
						let that=this;
						/* alert(serNumber); */
						$.ajax({
							url:"http://127.0.0.1:8080/servicing/selServicingById/"+serNumber,
							type:"get",
							xhrFields: {
								withCredentials: true
							},
							crossDomain: true,
							async:false,
							success:function(result){
								console.log(result);
								that.addServicing=result;
							}
						});
					},
					//保存维修项目
					saveWxProject(){
						let that = this;
						alert("保存单个项目");
						console.log(this.serproject);
							$.ajax({
								url:"http://127.0.0.1:8080/servicingproject/addWxProject",
								type:"post",
								data:that.serproject,
								xhrFields: {
								withCredentials: true
								},
								crossDomain: true,
								async:false,
								success:function(result){
									if(result){
										alert("保存成功！")
									}else{
										alert("保存失败！")
									}
									$("#wxMoal").modal("hide");
									/* location.reload(); */
								}
							})
						
					},
					//查所有班组
					teamFormAll(){
						let that = this;
						$.ajax({
							url:"http://127.0.0.1:8080/teamForm/bzFind",
							dataType:"json",
							success:function(result){
								console.log(result);
								that.teamForm = result;
							}
						})
					},
					//接车完成
					takeCarFinish(){
						let that=this;
						var json=JSON.stringify(that.addServicing);
						var flag= confirm("是否接车完毕?");
						if(flag){
							$.ajax({
							url:"http://127.0.0.1:8080/servicing/takeCarFinish",
							data:json,
							type:"post",
							xhrFields: {
								withCredentials: true
							},
							crossDomain: true,
							async:false,
							contentType:"application/json;charset=utf-8",
							success:function(result){
								alert(result);
							}
						});
						/* alert("竣工检验"); */
						var message={
								aa:'bb',
								val:this.closeLogin,
						}
						window.parent.postMessage(message, "*");
						}
					},
					//竣工检验
					testOnCompletion(){
						let that=this;
						var json=JSON.stringify(that.addServicing);
						$.ajax({
							url:"http://127.0.0.1:8080/servicing/testOnCompletion",
							data:json,
							type:"post",
							xhrFields: {
								withCredentials: true
							},
							crossDomain: true,
							async:false,
							contentType:"application/json;charset=utf-8",
							success:function(result){
								alert(result);
							}
						});
						/* alert("竣工检验"); */
						var message={
								aa:'bb',
								val:this.closeLogin,
						}
						window.parent.postMessage(message, "*");
					},
					//结算
					settlement(){
						var serNumber=this.addServicing.serNumber;
						let that=this;
						$.ajax({
							url:"http://127.0.0.1:8080/listOfSales/addListOfSale/"+serNumber,
							type:"post",
							xhrFields: {
								withCredentials: true
							},
							crossDomain: true,
							async:false,
							success:function(result){
								if(result){
									alert("成功");
									var message={
											aa:'cc',
											val:this.closeLogin,
									}
									window.parent.postMessage(message, "*");
								}else{
									alert("失败");
								}
							}
						});
						alert("结算");
					},
					//根据维修单号查询当前单号下的维修项目
					selServicingProjectBySerNumber(){
						let that=this;
						var serNumber=that.addServicing.serNumber;
						$.ajax({
							url:"http://127.0.0.1:8080/servicingproject/selBySerNumber/"+serNumber,
							type:"get",
							xhrFields: {
								withCredentials: true
							},
							crossDomain: true,
							async:false,
							dataType:"json",
							success:function(result){
								that.ServicingProjectList=result;
							}
						});
					},
					//查询该维修单的预计金额
					selSumPrice(){
						let that=this;
						var serNumber=that.addServicing.serNumber;
						/* alert(serNumber); */
						$.ajax({
							url:"http://127.0.0.1:8080/servicingproject/getPrice/"+serNumber,
							type:"get",
							xhrFields: {
								withCredentials: true
							},
							crossDomain: true,
							async:false,
							success:function(result){
								console.log(result);
								that.addServicing.serExpectmoney=result;
							}
						});
					}
				},
				created(){
					this.teamFormAll();
				}
			})
			
		</script>
	</body>
</html>
