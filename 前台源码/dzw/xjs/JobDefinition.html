<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>岗位定义</title>
		<link rel="stylesheet" href="css/bootstrap.min.css" />
		<style type="text/css">
			.clear1{
				display: block;
				content: '';
				clear: both;
			}
			.bodyDiv{
				width: 100%;
				background-color: ghostwhite
			}
			.table{
				margin: 20px auto;
			}
			.labcolor{
				font-size: 20px;
				color: greenyellow;
			}
			.headDiv{
				background-color:ghostwhite;
				width: 100%;
				height:80px;
			}
			.headDiv_left {
				font-size: 26px;
				margin: 20px 30px;
				height: 40px;
				line-height: 40px;
				float: left;
			}
			.headDiv_right{
				float: right;
				height: 40px;
				line-height: 40px;
				margin: 20px 30px;
			}
			.btn{
				height: 40px;
				line-height: 40px;
				text-align: center;
				padding: 0px 12px;
				margin-left: 10px;
			}
			.buttonMenus{
				/*margin-top: 20px;*/
				margin-right: 20px;
				background-color:whitesmoke;
				text-align: right;				
			}
			.table{
				width: 80%;
				margin-left: 5%;
			}
			.table th{
				color: white;
				background-color: deepskyblue;
				border: 1px solid black;
			}
			.table td{
				border: 1px solid gray;
			}
			body{
				width: 100%;
				height: 100%;
				margin: 0px;
				padding: 0px;
				background-color: ghostwhite
			}
		</style>
	</head>
	<body>
		<div id="ctx">
				<div class="clear1 headDiv">
					<div class="headDiv_left">岗位定义</div>
						<div class="headDiv_right">
						<button class="btn btn-danger">关闭</button>
					</div>
				</div>
				<div class="bodyDiv">
					<div class="buttonMenus">
						<button class="btn btn-success" @click="add">增加</button>
						<button class="btn btn-danger" @click="remove">删除</button>
						<button class="btn btn-success" @click="update">保存</button>
						<button class="btn btn-info" @click="daoChu">导出</button>
					</div>
					<div class="row">
						<div class="col-lg-3">
							<label for="jid" class="labcolor">岗位编码</label>
							<input type="text" name="" id="jid" value="" v-model="gangwei.jobId" />
						</div>									
						<div class="col-lg-3">
							<label for="jname" class="labcolor">岗位名称</label>
							<input type="text" name="" id="jname" value="" v-model="gangwei.jobName"/>
						</div>									
					</div>
					<div>
						<table class="table">
							<tr>
								<th>岗位编号</th>
								<th>岗位名称</th>
							</tr>
							<tr v-for="item,index in list" @click="tc(item,index)">
								<td>{{item.jobId}}</td>
								<td>{{item.jobName}}</td>
							</tr>
						</table>
					</div>
					<div>
					合计:<span>{{num}}</span>条记录
					</div>
				</div>
		</div>	
	</body>
	<script type="text/javascript" src="js/jquery-1.12.4.js" ></script>
	<script type="text/javascript" src="js/bootstrap.min.js" ></script>
	<script type="text/javascript" src="js/vue.js" ></script>
	<script type="text/javascript">
		new Vue({
			el:"#ctx",
			data(){
				return{
					gw:[],
					list:[],
					num:0,
					gangwei:{
						jobId:"",
						jobName:"",
						column1:null,
						column2:null,
						column3:null
					},
					//删除用的index
					index:0
				}
			},
			methods:{
				getCount(){
					let that=this;
					$.ajax({
						url:"http://127.0.0.1:8080/job/count",
						xhrFields: {
							withCredentials: true
						},
						crossDomain: true,
						type:"get",
						success:function(result){
							that.num=result;
						}
					});
				},
				find(){
					let that=this;
					$.ajax({
						url:"http://127.0.0.1:8080/job",
						type:"get",
						dataType:"json",
						xhrFields: {
							withCredentials: true
						},
						crossDomain: true,
						 async:false,
						success:function(result){
							console.log(result);
							that.list=result;
						}
					});
					/*this.gw=this.list;*/
					/*this.num=this.a;*/
				},
				add(){
					let that =this;
					if(that.gangwei.jobId.trim()!=""&&that.gangwei.jobName.trim()!=""){
							var json =JSON.stringify(that.gangwei);
						$.ajax({
							url:"http://127.0.0.1:8080/job",
							type:"post",
							contentType:"application/json;charset=utf-8",
							xhrFields: {
								withCredentials: true
							},
							crossDomain: true,
							data:json,
							async:false,
							success:function(result){
								if(result){
									alert("成功");
								}else{
									alert("失败")
								}
							}
						});
					}
					this.find();
					this.getCount();
				},
				remove(){
					let that=this;
					console.log(that.gangwei);
					$.ajax({
						url:"http://127.0.0.1:8080/job/remove/"+that.gangwei.jobId,
						type:"delete",
						xhrFields: {
							withCredentials: true
						},
						crossDomain: true,
						 async:false,
						success:function(result){
							alert(result);
						}
					});
					this.find();
					this.getCount();
				},
				update(){
					let that =this;
					if(that.gangwei.jobId.trim()!=""&&that.gangwei.jobName.trim()!=""){
						var json=JSON.stringify(that.gangwei);
						$.ajax({
							url:"http://127.0.0.1:8080/job",
							contentType:"application/json;charset=utf-8",
							type:"put",
							xhrFields: {
								withCredentials: true
							},
							async:false,
							crossDomain: true,
							data:json,
							success:function(result){
								alert(result);
							}
						});
					}
					this.find();
					this.getCount();
				},
				daoChu(){
					window.location.href="http://127.0.0.1:8080/job/downLoadExportExcel";
					alert("导出成功");
				},
				tc(item,index){
					this.gangwei.jobId=item.jobId;
					this.gangwei.jobName=item.jobName;
					/*this.index=index;*/
				}
			},
			created(){
				this.getCount();
				this.find();
			}
		});
	</script>
</html>
