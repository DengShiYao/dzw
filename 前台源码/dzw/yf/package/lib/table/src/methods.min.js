"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _ctor=_interopRequireDefault(require("xe-utils/ctor")),_conf=_interopRequireDefault(require("../../conf")),_cell=_interopRequireDefault(require("./cell")),_vXETable=_interopRequireDefault(require("../../v-x-e-table")),_tools=require("../../tools"),_util=require("./util"),_formats=_interopRequireDefault(require("../../v-x-e-table/src/formats"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var getRowid=_tools.UtilTools.getRowid,getRowkey=_tools.UtilTools.getRowkey,setCellValue=_tools.UtilTools.setCellValue,hasChildrenList=_tools.UtilTools.hasChildrenList,getColumnList=_tools.UtilTools.getColumnList,browse=_tools.DomTools.browse,calcHeight=_tools.DomTools.calcHeight,hasClass=_tools.DomTools.hasClass,addClass=_tools.DomTools.addClass,removeClass=_tools.DomTools.removeClass,getEventTargetNode=_tools.DomTools.getEventTargetNode,isWebkit=browse["-webkit"]&&!browse.edge,debounceScrollYDuration=browse.msie?40:20,resizableStorageKey="VXE_TABLE_CUSTOM_COLUMN_WIDTH",visibleStorageKey="VXE_TABLE_CUSTOM_COLUMN_VISIBLE";function getRowUniqueId(){return _ctor.default.uniqueId("row_")}function eqCellNull(e){return""===e||_ctor.default.eqNull(e)}function eqCellValue(e,t,r){var o=_ctor.default.get(e,r),i=_ctor.default.get(t,r);return!(!eqCellNull(o)||!eqCellNull(i))||(_ctor.default.isString(o)||_ctor.default.isNumber(o)?o==i:_ctor.default.isEqual(o,i))}function getNextSortOrder(e,t){var r=e.sortOpts.orders,o=t.order||null,i=r.indexOf(o)+1;return r[i<r.length?i:0]}function getCustomStorageMap(e){var t=_conf.default.version,r=_ctor.default.toStringJSON(localStorage.getItem(e));return r&&r._v===t?r:{_v:t}}function getRecoverRow(e,t){var r=e.fullAllDataRowMap;return t.filter(function(e){return r.has(e)})}function handleReserveRow(e,t){var r=e.fullDataRowIdData,o=[];return _ctor.default.each(t,function(e,t){r[t]&&-1===o.indexOf(r[t].row)&&o.push(r[t].row)}),o}function restoreScroll(e,t,r){return e.clearScroll().then(function(){if(t||r)return e.lastScrollLeft=0,e.lastScrollTop=0,e.scrollTo(t,r)})}function computeVirtualX(e){var t=e.$refs,r=e.visibleColumn,o=t.tableBody,i=o?o.$el:null;if(i){for(var n=i.scrollLeft,l=n+i.clientWidth,a=-1,s=0,c=0,u=0,h=r.length;u<h&&(s+=r[u].renderWidth,-1===a&&n<s&&(a=u),!(0<=a&&(c++,l<s)));u++);return{toVisibleIndex:Math.max(0,a),visibleSize:Math.max(8,c)}}return{toVisibleIndex:0,visibleSize:8}}function computeVirtualY(e){var t=e.$refs,r=e.vSize,o=e.rowHeightMaps,i=t.tableHeader,n=t.tableBody,l=n?n.$el:null;if(l){var a,s=i?i.$el:null,c=0;return!(a=l.querySelector("tr"))&&s&&(a=s.querySelector("tr")),a&&(c=a.clientHeight),c||(c=o[r||"default"]),{rowHeight:c,visibleSize:Math.max(8,Math.ceil(l.clientHeight/c)+2)}}return{rowHeight:0,visibleSize:8}}function calculateMergerOffserIndex(e,t,r){for(var o=0,i=e.length;o<i;o++){var n=e[o],l=t.startIndex,a=t.endIndex,s=n[r],c=s+n[r+"span"];s<l&&l<c&&(t.startIndex=s),s<a&&a<c&&(t.endIndex=c),t.startIndex===l&&t.endIndex===a||(o=-1)}}function setMerges(e,t,c,u){if(t){var r=e.treeConfig,h=e.visibleColumn;if(r)throw new Error(_tools.UtilTools.getLog("vxe.error.noTree",["merge-footer-items"]));_ctor.default.isArray(t)||(t=[t]),t.forEach(function(e){var t=e.row,r=e.col,o=e.rowspan,i=e.colspan;if(u&&_ctor.default.isNumber(t)&&(t=u[t]),_ctor.default.isNumber(r)&&(r=h[r]),(u?t:_ctor.default.isNumber(t))&&r&&(o||i)&&(o=_ctor.default.toNumber(o)||1,i=_ctor.default.toNumber(i)||1,1<o||1<i)){var n=_ctor.default.findIndexOf(c,function(e){return e._row===t&&e._col===r}),l=c[n];if(l)l.rowspan=o,l.colspan=i,l._rowspan=o,l._colspan=i;else{var a=u?u.indexOf(t):t,s=h.indexOf(r);c.push({row:a,col:s,rowspan:o,colspan:i,_row:t,_col:r,_rowspan:o,_colspan:i})}}})}}function removeMerges(e,t,n,l){var a=[];if(t){var r=e.treeConfig,s=e.visibleColumn;if(r)throw new Error(_tools.UtilTools.getLog("vxe.error.noTree",["merge-cells"]));_ctor.default.isArray(t)||(t=[t]),t.forEach(function(e){var t=e.row,r=e.col;l&&_ctor.default.isNumber(t)&&(t=l[t]),_ctor.default.isNumber(r)&&(r=s[r]);var o=_ctor.default.findIndexOf(n,function(e){return e._row===t&&e._col===r});if(-1<o){var i=n.splice(o,1);a.push(i[0])}})}return a}function clearAllSort(e){e.tableFullColumn.forEach(function(e){e.order=null})}var Methods={callSlot:function(e,t,r,o){if(e){var i=this.$xegrid;if(i)return i.callSlot(e,t,r,o);if(_ctor.default.isFunction(e))return e.call(this,t,r,o)}return[]},getParentElem:function(){return this.$xegrid?this.$xegrid.$el.parentNode:this.$el.parentNode},getParentHeight:function(){return this.$xegrid?this.$xegrid.getParentHeight():this.getParentElem().clientHeight},getExcludeHeight:function(){return this.$xegrid?this.$xegrid.getExcludeHeight():0},clearAll:function(){return(0,_util.clearTableAllStatus)(this)},syncData:function(){var e=this;return this.$nextTick().then(function(){return e.tableData=[],e.$nextTick().then(function(){return e.loadTableData(e.tableFullData)})})},updateData:function(){return this.handleTableData(!0).then(this.updateFooter).then(this.recalculate)},handleTableData:function(e){var t=this.scrollYLoad,r=this.scrollYStore,o=e?this.updateAfterFullData():this.afterFullData;return this.tableData=t?o.slice(r.startIndex,r.endIndex):o.slice(0),this.$nextTick()},loadTableData:function(e){var t=this,r=this.keepSource,o=this.treeConfig,i=this.editStore,n=this.sYOpts,l=this.scrollYStore,a=this.scrollXStore,s=this.lastScrollLeft,c=this.lastScrollTop,u=e?e.slice(0):[],h=!o&&n.enabled&&-1<n.gt&&n.gt<u.length;return l.startIndex=0,l.endIndex=1,a.startIndex=0,a.endIndex=1,i.insertList=[],i.removeList=[],this.tableFullData=u,this.updateCache(!0),this.tableSynchData=e,r&&(this.tableSourceData=_ctor.default.clone(u,!0)),this.scrollYLoad=h,"development"===process.env.VUE_APP_VXE_TABLE_ENV&&h&&(this.height||this.maxHeight||_tools.UtilTools.error("vxe.error.reqProp",["table.height | table.max-height | table.scroll-y={enabled: false}"]),this.showOverflow||_tools.UtilTools.warn("vxe.error.reqProp",["table.show-overflow"]),this.spanMethod&&_tools.UtilTools.warn("vxe.error.scrollErrProp",["table.span-method"])),this.clearMergeCells(),this.clearMergeFooterItems(),this.handleTableData(!0),this.updateFooter(),this.computeScrollLoad().then(function(){return h&&(l.endIndex=l.visibleSize),t.handleReserveStatus(),t.checkSelectionStatus(),t.$nextTick().then(function(){return t.recalculate()}).then(function(){return restoreScroll(t,s,c)})})},loadData:function(e){var t=this;return this.loadTableData(e).then(function(){return t.inited=!0,t.initStatus||(t.initStatus=!0,t.handleDefaults()),t.recalculate()})},reloadData:function(e){var t=this;return this.clearAll().then(function(){return t.inited=!0,t.initStatus=!0,t.loadTableData(e)}).then(function(){return t.handleDefaults(),t.recalculate()})},reloadRow:function(e,t,r){var o=this.keepSource,i=this.tableSourceData,n=this.tableData;if(o){var l=this.getRowIndex(e),a=i[l];a&&e&&(r?_ctor.default.set(a,r,_ctor.default.get(t||e,r)):t?(i[l]=t,_ctor.default.clear(e,void 0),Object.assign(e,this.defineField(Object.assign({},t))),this.updateCache(!0)):_ctor.default.destructuring(a,_ctor.default.clone(e,!0))),this.tableData=n.slice(0)}else"development"===process.env.VUE_APP_VXE_TABLE_ENV&&_tools.UtilTools.warn("vxe.error.reqProp",["keep-source"]);return this.$nextTick()},loadColumn:function(e){var t=this,r=_ctor.default.mapTree(e,function(e){return _cell.default.createColumn(t,e)});return this.handleColumn(r),this.$nextTick()},reloadColumn:function(e){return this.clearAll(),this.loadColumn(e)},handleColumn:function(e){var t=this;this.collectColumn=e;var r=getColumnList(e);this.tableFullColumn=r,this.cacheColumnMap(),this.restoreCustomStorage(),this.refreshColumn().then(function(){t.scrollXLoad&&t.loadScrollXData(!0)}),this.clearMergeCells(),this.clearMergeFooterItems(),this.handleTableData(!0),"development"===process.env.VUE_APP_VXE_TABLE_ENV&&(this.scrollXLoad||this.scrollYLoad)&&this.expandColumn&&_tools.UtilTools.warn("vxe.error.scrollErrProp",["column.type=expand"]),this.$nextTick(function(){t.$toolbar&&t.$toolbar.syncUpdate({collectColumn:e,$table:t})})},updateCache:function(a){var s=this,c=this.treeConfig,u=this.treeOpts,e=this.tableFullData,h=this.fullDataRowMap,d=this.fullAllDataRowMap,f=this.fullDataRowIdData,v=this.fullAllDataRowIdData,g=getRowkey(this),p=c&&u.lazy,t=function(e,t,r,o,i){var n=getRowid(s,e);n||(n=getRowUniqueId(),_ctor.default.set(e,g,n)),p&&e[u.hasChild]&&_ctor.default.isUndefined(e[u.children])&&(e[u.children]=null);var l={row:e,rowid:n,index:c&&i?-1:t,items:r,parent:i};a&&(f[n]=l,h.set(e,l)),v[n]=l,d.set(e,l)};a&&(f=this.fullDataRowIdData={},h.clear()),v=this.fullAllDataRowIdData={},d.clear(),c?_ctor.default.eachTree(e,t,u):e.forEach(t)},loadChildren:function(h,e){var d=this;return this.createData(e).then(function(e){var t=d.keepSource,r=d.tableSourceData,o=d.treeOpts,a=d.fullDataRowIdData,s=d.fullDataRowMap,c=d.fullAllDataRowMap,u=d.fullAllDataRowIdData,i=o.children;if(t){var n=getRowid(d,h),l=_ctor.default.findTree(r,function(e){return n===getRowid(d,e)},o);l&&(l.item[i]=_ctor.default.clone(e,!0))}return _ctor.default.eachTree(e,function(e,t,r,o,i){var n=getRowid(d,e),l={row:e,rowid:n,index:-1,items:r,parent:i};a[n]=l,s.set(e,l),u[n]=l,c.set(e,l)},o),h[i]=e})},cacheColumnMap:function(){var h,d,f,v,g,p=this,e=this.tableFullColumn,t=this.collectColumn,m=this.fullColumnMap,r=this.showOverflow,x=this.fullColumnIdData={},w=this.fullColumnFieldData={},o=t.some(hasChildrenList),C=!!r,l=function(e,t,r,o,i){var n=e.id,l=e.property,a=e.fixed,s=e.type,c=e.treeNode,u={column:e,colid:n,index:t,items:r,parent:i};l&&("development"===process.env.VUE_APP_VXE_TABLE_ENV&&w[l]&&_tools.UtilTools.error("vxe.error.colRepet",["field",l]),w[l]=u),!g&&a&&(g=a),c?("development"===process.env.VUE_APP_VXE_TABLE_ENV&&d&&_tools.UtilTools.warn("vxe.error.colRepet",["tree-node",c]),d||(d=e)):"expand"===s&&("development"===process.env.VUE_APP_VXE_TABLE_ENV&&h&&_tools.UtilTools.warn("vxe.error.colRepet",["type",s]),h||(h=e)),"development"===process.env.VUE_APP_VXE_TABLE_ENV&&("checkbox"===s?(f&&_tools.UtilTools.warn("vxe.error.colRepet",["type",s]),f||(f=e)):"radio"===s&&(v&&_tools.UtilTools.warn("vxe.error.colRepet",["type",s]),v||(v=e))),"development"===process.env.VUE_APP_VXE_TABLE_ENV&&(p.showOverflow&&!1===e.showOverflow&&_tools.UtilTools.warn("vxe.error.errConflicts",["table.show-overflow=".concat(p.showOverflow),"column.show-overflow=".concat(e.showOverflow)]),p.showHeaderOverflow&&!1===e.showHeaderOverflow&&_tools.UtilTools.warn("vxe.error.errConflicts",["table.show-header-overflow=".concat(p.showHeaderOverflow),"column.show-header-overflow=".concat(e.showHeaderOverflow)]),p.showFooterOverflow&&!1===e.showFooterOverflow&&_tools.UtilTools.warn("vxe.error.errConflicts",["table.show-footer-overflow=".concat(p.showFooterOverflow),"column.show-footer-overflow=".concat(e.showFooterOverflow)])),C&&!1===e.showOverflow&&(C=!1),x[n]&&_tools.UtilTools.error("vxe.error.colRepet",["colId",n]),x[n]=u,m.set(e,u)};m.clear(),o?_ctor.default.eachTree(t,function(e,t,r,o,i,n){e.level=n.length,l(e,t,r,0,i)}):e.forEach(l),"development"===process.env.VUE_APP_VXE_TABLE_ENV&&(h&&g&&_tools.UtilTools.warn("vxe.error.errConflicts",["column.fixed","column.type=expand"]),h&&this.mouseOpts.area&&_tools.UtilTools.error("vxe.error.errConflicts",["mouse-config.area","column.type=expand"])),this.isGroup=o,this.treeNodeColumn=d,this.expandColumn=h,this.isAllOverflow=C},getRowNode:function(e){if(e){var t=this.fullAllDataRowIdData[e.getAttribute("rowid")];if(t)return{rowid:t.rowid,item:t.row,index:t.index,items:t.items,parent:t.parent}}return null},getColumnNode:function(e){if(e){var t=this.fullColumnIdData[e.getAttribute("colid")];if(t)return{colid:t.colid,item:t.column,index:t.index,items:t.items,parent:t.parent}}return null},getRowIndex:function(e){return this.fullDataRowMap.has(e)?this.fullDataRowMap.get(e).index:-1},getVTRowIndex:function(e){return this.afterFullData.indexOf(e)},_getRowIndex:function(e){return"development"===process.env.VUE_APP_VXE_TABLE_ENV&&_tools.UtilTools.warn("vxe.error.delFunc",["_getRowIndex","getVTRowIndex"]),this.getVTRowIndex(e)},getVMRowIndex:function(e){return this.tableData.indexOf(e)},$getRowIndex:function(e){return"development"===process.env.VUE_APP_VXE_TABLE_ENV&&_tools.UtilTools.warn("vxe.error.delFunc",["$getRowIndex","getVMRowIndex"]),this.getVMRowIndex(e)},getColumnIndex:function(e){return this.fullColumnMap.has(e)?this.fullColumnMap.get(e).index:-1},getVTColumnIndex:function(e){return this.visibleColumn.indexOf(e)},_getColumnIndex:function(e){return"development"===process.env.VUE_APP_VXE_TABLE_ENV&&_tools.UtilTools.warn("vxe.error.delFunc",["_getColumnIndex","getVTColumnIndex"]),this.getVTColumnIndex(e)},getVMColumnIndex:function(e){return this.tableColumn.indexOf(e)},$getColumnIndex:function(e){return"development"===process.env.VUE_APP_VXE_TABLE_ENV&&_tools.UtilTools.warn("vxe.error.delFunc",["$getColumnIndex","getVMColumnIndex"]),this.getVMColumnIndex(e)},isSeqColumn:function(e){return e&&"seq"===e.type},defineField:function(o){var e=this.radioOpts,t=this.checkboxOpts,r=this.treeConfig,i=this.treeOpts,n=this.expandOpts,l=getRowkey(this);return this.visibleColumn.forEach(function(e){var t=e.property,r=e.editRender;t&&!_ctor.default.has(o,t)&&_ctor.default.set(o,t,r&&!_ctor.default.isUndefined(r.defaultValue)?r.defaultValue:null)}),[e.labelField,t.checkField,t.labelField,n.labelField].forEach(function(e){e&&!_ctor.default.get(o,e)&&_ctor.default.set(o,e,null)}),r&&i.lazy&&_ctor.default.isUndefined(o[i.children])&&(o[i.children]=null),_ctor.default.get(o,l)||_ctor.default.set(o,l,getRowUniqueId()),o},createData:function(e){var t=this,r=this.treeConfig,o=this.treeOpts,i=function(e){return t.defineField(Object.assign({},e))},n=r?_ctor.default.mapTree(e,i,o):e.map(i);return this.$nextTick().then(function(){return n})},createRow:function(e){var t=this,r=_ctor.default.isArray(e);return r||(e=[e]),this.$nextTick().then(function(){return t.createData(e).then(function(e){return r?e:e[0]})})},revertData:function(e,o){var i=this,t=this.keepSource,n=this.tableSourceData,l=this.treeConfig;return t?arguments.length?(e&&!_ctor.default.isArray(e)&&(e=[e]),e.forEach(function(e){if(!i.isInsertByRow(e)){var t=i.getRowIndex(e);if(l&&-1===t)throw new Error(_tools.UtilTools.getLog("vxe.error.noTree",["revertData"]));var r=n[t];r&&e&&(o?_ctor.default.set(e,o,_ctor.default.clone(_ctor.default.get(r,o),!0)):_ctor.default.destructuring(e,_ctor.default.clone(r,!0)))}}),this.$nextTick()):this.reloadData(n):("development"===process.env.VUE_APP_VXE_TABLE_ENV&&_tools.UtilTools.warn("vxe.error.reqProp",["keep-source"]),this.$nextTick())},clearData:function(e,t){var r=this.tableFullData,o=this.visibleColumn;return arguments.length?e&&!_ctor.default.isArray(e)&&(e=[e]):e=r,t?e.forEach(function(e){return _ctor.default.set(e,t,null)}):e.forEach(function(t){o.forEach(function(e){e.property&&setCellValue(t,e,null)})}),this.$nextTick()},isInsertByRow:function(e){return-1<this.editStore.insertList.indexOf(e)},isUpdateByRow:function(e,t){var r=this,o=this.visibleColumn,i=this.keepSource,n=this.treeConfig,l=this.treeOpts,a=this.tableSourceData,s=this.fullDataRowIdData;if(i){var c,u,h=getRowid(this,e);if(!s[h])return!1;if(n){var d=l.children,f=_ctor.default.findTree(a,function(e){return h===getRowid(r,e)},l);e=Object.assign({},e,_defineProperty({},d,null)),f&&(c=Object.assign({},f.item,_defineProperty({},d,null)))}else{c=a[s[h].index]}if(c){if(1<arguments.length)return!eqCellValue(c,e,t);for(var v=0,g=o.length;v<g;v++)if((u=o[v].property)&&!eqCellValue(c,e,u))return!0}}return!1},getColumns:function(e){var t=this.visibleColumn;return arguments.length?t[e]:t.slice(0)},getColumnById:function(e){var t=this.fullColumnIdData;return t[e]?t[e].column:null},getColumnByField:function(e){var t=this.fullColumnFieldData;return t[e]?t[e].column:null},getTableColumn:function(){return{collectColumn:this.collectColumn.slice(0),fullColumn:this.tableFullColumn.slice(0),visibleColumn:this.visibleColumn.slice(0),tableColumn:this.tableColumn.slice(0)}},getData:function(e){var t=this.data||this.tableSynchData;return arguments.length?t[e]:t.slice(0)},getCheckboxRecords:function(){var e=this.tableFullData,t=this.treeConfig,r=this.treeOpts,o=this.checkboxOpts.checkField,i=[];if(o)i=t?_ctor.default.filterTree(e,function(e){return _ctor.default.get(e,o)},r):e.filter(function(e){return _ctor.default.get(e,o)});else{var n=this.selection;i=t?_ctor.default.filterTree(e,function(e){return-1<n.indexOf(e)},r):e.filter(function(e){return-1<n.indexOf(e)})}return i},updateAfterFullData:function(){var i=this,e=this.visibleColumn,t=this.tableFullData,r=this.filterOpts,o=this.sortOpts,c=r.remote,u=r.filterMethod,l=o.remote,n=o.sortMethod,a=o.multiple,s=t.slice(0),h=[],d=[];e.forEach(function(e){var t=e.sortable,r=e.order,o=e.filters;if(!c&&o&&o.length){var i=[],n=[];o.forEach(function(e){e.checked&&(n.push(e),i.push(e.value))}),n.length&&h.push({column:e,valueList:i,itemList:n})}!l&&t&&r&&d.push({column:e,sortBy:e.sortBy,property:e.property,order:r})}),h.length&&(s=s.filter(function(s){return h.every(function(e){var t=e.column,r=e.valueList,o=e.itemList;if(!r.length||c)return!0;var i=t.filterRender,n=t.property,l=t.filterMethod,a=i?_vXETable.default.renderer.get(i.name):null;return!l&&a&&a.renderFilter&&(l=a.filterMethod),u&&!l?u({options:o,values:r,row:s,column:t}):l?o.some(function(e){return l({value:e.value,option:e,row:s,column:t})}):-1<r.indexOf(_ctor.default.get(s,n))})}));var f=d[0];if(!l&&f)if(n){var v=n({data:s,column:f.column,property:f.property,order:f.order,sortList:d,$table:this});s=_ctor.default.isArray(v)?v:s}else{var g;if(a)s=_ctor.default.orderBy(s,d.map(function(e){var t=e.column,r=e.property,o=e.order;return[(t.sortBy?_ctor.default.isArray(t.sortBy)?t.sortBy[0]:t.sortBy:null)||(t.formatter?function(e){return i.getCellLabel(e,t)}:r),o]}));else f.sortBy&&(g=(_ctor.default.isArray(f.sortBy)?f.sortBy:[f.sortBy]).map(function(e){return{field:e,order:f.order}})),s=_ctor.default.orderBy(s,g||[f].map(function(e){var t=e.column,r=e.property,o=e.order;return[t.formatter?function(e){return i.getCellLabel(e,t)}:r,o]}))}return this.afterFullData=s},getRowById:function(e){var t=this.fullDataRowIdData;return t[e]?t[e].row:null},getRowid:function(e){var t=this.fullAllDataRowMap;return t.has(e)?t.get(e).rowid:null},getTableData:function(){var e=this.tableFullData,t=this.afterFullData,r=this.tableData,o=this.footerData;return{fullData:e.slice(0),visibleData:t.slice(0),tableData:r.slice(0),footerData:o.slice(0)}},handleDefaults:function(){var e=this;this.checkboxConfig&&this.handleDefaultSelectionChecked(),this.radioConfig&&this.handleDefaultRadioChecked(),this.expandConfig&&this.handleDefaultRowExpand(),this.treeConfig&&this.handleDefaultTreeExpand(),this.mergeCells&&this.handleDefaultMergeCells(),this.mergeFooterItems&&this.handleDefaultMergeFooterItems(),this.$nextTick(function(){return setTimeout(e.recalculate)})},hideColumn:function(e){var t=(0,_util.handleFieldOrColumn)(this,e);return t&&(t.visible=!1),this.handleCustom()},showColumn:function(e){var t=(0,_util.handleFieldOrColumn)(this,e);return t&&(t.visible=!0),this.handleCustom()},resetColumn:function(e){var t=this.customOpts.checkMethod,r=Object.assign({visible:!0,resizable:!0===e},e);return this.tableFullColumn.forEach(function(e){r.resizable&&(e.resizeWidth=0),t&&!t({column:e})||(e.visible=e.defaultVisible)}),r.resizable&&this.saveCustomResizable(!0),this.handleCustom()},handleCustom:function(){return this.saveCustomVisible(),this.analyColumnWidth(),this.refreshColumn()},restoreCustomStorage:function(){var e=this.id,t=this.collectColumn,r=this.customConfig,o=this.customOpts,i=o.storage,n=!0===o.storage,l=n||i&&i.resizable,a=n||i&&i.visible;if(r&&(l||a)){var s={};if(!e)return void _tools.UtilTools.error("vxe.error.reqProp",["id"]);if(l){var c=getCustomStorageMap(resizableStorageKey)[e];c&&_ctor.default.each(c,function(e,t){s[t]={field:t,resizeWidth:e}})}if(a){var u=getCustomStorageMap(visibleStorageKey)[e];if(u){var h=u.split("|"),d=h[0]?h[0].split(","):[],f=h[1]?h[1].split(","):[];d.forEach(function(e){s[e]?s[e].visible=!1:s[e]={field:e,visible:!1}}),f.forEach(function(e){s[e]?s[e].visible=!0:s[e]={field:e,visible:!0}})}}var v={};_ctor.default.eachTree(t,function(e){var t=e.getKey();t&&(v[t]=e)}),_ctor.default.each(s,function(e,t){var r=e.visible,o=e.resizeWidth,i=v[t];i&&(_ctor.default.isNumber(o)&&(i.resizeWidth=o),_ctor.default.isBoolean(r)&&(i.visible=r))})}},saveCustomVisible:function(){var e=this.id,t=this.collectColumn,r=this.customConfig,o=this.customOpts,i=o.checkMethod,n=o.storage,l=!0===o.storage||n&&n.visible;if(r&&l){var a=getCustomStorageMap(visibleStorageKey),s=[],c=[];if(!e)return void _tools.UtilTools.error("vxe.error.reqProp",["id"]);_ctor.default.eachTree(t,function(e){if(!i||i({column:e}))if(!e.visible&&e.defaultVisible){var t=e.getKey();t&&s.push(t)}else if(e.visible&&!e.defaultVisible){var r=e.getKey();r&&c.push(r)}}),a[e]=[s.join(",")].concat(c.length?[c.join(",")]:[]).join("|")||void 0,localStorage.setItem(visibleStorageKey,_ctor.default.toJSONString(a))}},saveCustomResizable:function(e){var t=this.id,r=this.collectColumn,o=this.customConfig,i=this.customOpts,n=i.storage,l=!0===i.storage||n&&n.resizable;if(o&&l){var a,s=getCustomStorageMap(resizableStorageKey);if(!t)return void _tools.UtilTools.error("vxe.error.reqProp",["id"]);e||(a=_ctor.default.isPlainObject(s[t])?s[t]:{},_ctor.default.eachTree(r,function(e){if(e.resizeWidth){var t=e.getKey();t&&(a[t]=e.renderWidth)}})),s[t]=_ctor.default.isEmpty(a)?void 0:a,localStorage.setItem(resizableStorageKey,_ctor.default.toJSONString(s))}},refreshColumn:function(){var e=this,l=[],a=[],s=[],t=this.collectColumn,r=this.tableFullColumn,o=this.isGroup,i=this.columnStore,n=this.sXOpts,c=this.scrollXStore;if(o){var u=[],h=[],d=[];_ctor.default.eachTree(t,function(e,t,r,o,i){var n=hasChildrenList(e);i&&i.fixed&&(e.fixed=i.fixed),i&&e.fixed!==i.fixed&&_tools.UtilTools.error("vxe.error.groupFixed"),n?e.visible=!!_ctor.default.findTree(e.children,function(e){return hasChildrenList(e)?null:e.visible}):e.visible&&("left"===e.fixed?l.push(e):"right"===e.fixed?s.push(e):a.push(e))}),t.forEach(function(e){e.visible&&("left"===e.fixed?u.push(e):"right"===e.fixed?d.push(e):h.push(e))}),this.tableGroupColumn=u.concat(h).concat(d)}else r.forEach(function(e){e.visible&&("left"===e.fixed?l.push(e):"right"===e.fixed?s.push(e):a.push(e))});var f=l.concat(a).concat(s),v=n.enabled&&-1<n.gt&&n.gt<r.length;if(Object.assign(i,{leftList:l,centerList:a,rightList:s}),v&&o&&(v=!1,"development"===process.env.VUE_APP_VXE_TABLE_ENV&&_tools.UtilTools.warn("vxe.error.scrollXNotGroup")),v){"development"===process.env.VUE_APP_VXE_TABLE_ENV&&(this.showHeader&&!this.showHeaderOverflow&&_tools.UtilTools.warn("vxe.error.reqProp",["show-header-overflow"]),this.showFooter&&!this.showFooterOverflow&&_tools.UtilTools.warn("vxe.error.reqProp",["show-footer-overflow"]),this.spanMethod&&_tools.UtilTools.warn("vxe.error.scrollErrProp",["span-method"]),this.footerSpanMethod&&_tools.UtilTools.warn("vxe.error.scrollErrProp",["footer-span-method"]));var g=computeVirtualX(this).visibleSize;c.startIndex=0,c.endIndex=g,c.visibleSize=g}return f.length===this.visibleColumn.length&&this.visibleColumn.every(function(e,t){return e===f[t]})||(this.clearMergeCells(),this.clearMergeFooterItems()),this.scrollXLoad=v,this.visibleColumn=f,this.handleTableColumn(),this.$nextTick().then(function(){return e.updateFooter(),e.recalculate(!0)}).then(function(){return e.updateCellAreas(),e.$nextTick().then(function(){return e.recalculate()})})},analyColumnWidth:function(){var e=this.columnOpts,t=e.width,r=e.minWidth,o=[],i=[],n=[],l=[],a=[],s=[];this.tableFullColumn.forEach(function(e){t&&!e.width&&(e.width=t),r&&!e.minWidth&&(e.minWidth=r),e.visible&&(e.resizeWidth?o.push(e):_tools.DomTools.isPx(e.width)?i.push(e):_tools.DomTools.isScale(e.width)?l.push(e):_tools.DomTools.isPx(e.minWidth)?n.push(e):_tools.DomTools.isScale(e.minWidth)?a.push(e):s.push(e))}),Object.assign(this.columnStore,{resizeList:o,pxList:i,pxMinList:n,scaleList:l,scaleMinList:a,autoList:s})},refreshScroll:function(){return restoreScroll(this,this.lastScrollLeft,this.lastScrollTop)},recalculate:function(e){var t=this,r=this.$refs,o=r.tableBody,i=r.tableHeader,n=r.tableFooter,l=o?o.$el:null,a=i?i.$el:null,s=n?n.$el:null;return l&&(this.autoCellWidth(a,l,s),!0===e)?this.computeScrollLoad().then(function(){t.autoCellWidth(a,l,s),t.computeScrollLoad()}):this.computeScrollLoad()},autoCellWidth:function(e,t,r){var o=0,i=t.clientWidth,n=i,l=n/100,a=this.fit,s=this.columnStore,c=s.resizeList,u=s.pxMinList,h=s.pxList,d=s.scaleList,f=s.scaleMinList,v=s.autoList;if(u.forEach(function(e){var t=parseInt(e.minWidth);o+=t,e.renderWidth=t}),f.forEach(function(e){var t=Math.floor(parseInt(e.minWidth)*l);o+=t,e.renderWidth=t}),d.forEach(function(e){var t=Math.floor(parseInt(e.width)*l);o+=t,e.renderWidth=t}),h.forEach(function(e){var t=parseInt(e.width);o+=t,e.renderWidth=t}),c.forEach(function(e){var t=parseInt(e.resizeWidth);o+=t,e.renderWidth=t}),l=0<(n-=o)?Math.floor(n/(f.length+u.length+v.length)):0,a?0<n&&f.concat(u).forEach(function(e){o+=l,e.renderWidth+=l}):l=40,v.forEach(function(e){var t=Math.max(l,40);e.renderWidth=t,o+=t}),a){var g=d.concat(f).concat(u).concat(v),p=g.length-1;if(0<p){var m=i-o;if(0<m){for(;0<m&&0<=p;)m--,g[p--].renderWidth++;o=i}}}var x=t.offsetHeight,w=t.scrollHeight>t.clientHeight;if(this.scrollbarWidth=w?t.offsetWidth-i:0,this.overflowY=w,this.tableWidth=o,this.tableHeight=x,e?(this.headerHeight=e.clientHeight,e.scrollLeft!==t.scrollLeft&&(e.scrollLeft=t.scrollLeft)):this.headerHeight=0,r){var C=r.offsetHeight;this.scrollbarHeight=Math.max(C-r.clientHeight,0),this.overflowX=o>r.clientWidth,this.footerHeight=C}else this.footerHeight=0,this.scrollbarHeight=Math.max(x-t.clientHeight,0),this.overflowX=i<o;this.customHeight=calcHeight(this,"height"),this.customMaxHeight=calcHeight(this,"maxHeight"),this.parentHeight=Math.max(this.headerHeight+this.footerHeight+20,this.getParentHeight()),this.overflowX&&this.checkScrolling()},updateStyle:function(){var p=this,t=this.$refs,m=this.isGroup,x=this.fullColumnIdData,w=this.tableColumn,C=this.customHeight,b=this.customMaxHeight,T=this.border,_=this.headerHeight,R=this.showFooter,E=this.showOverflow,y=this.showHeaderOverflow,S=this.showFooterOverflow,k=this.footerHeight,O=this.tableHeight,D=this.tableWidth,I=this.scrollbarHeight,A=this.scrollbarWidth,$=this.scrollXLoad,M=this.scrollYLoad,L=this.cellOffsetWidth,F=this.columnStore,V=this.elemStore,e=this.editStore,r=this.currentRow,o=this.mouseConfig,i=t.emptyPlaceholder,n=V["main-body-wrapper"];return i&&(i.style.top="".concat(_,"px"),i.style.height=n?"".concat(n.offsetHeight-I,"px"):""),0<C&&R&&(C+=I),["main","left","right"].forEach(function(d,e){var f=0<e?d:"",v=F["".concat(f,"List")],g=t["".concat(f,"Container")];["header","body","footer"].forEach(function(c){var e=V["".concat(d,"-").concat(c,"-wrapper")],t=V["".concat(d,"-").concat(c,"-table")];if("header"===c){var r=D;$&&(f&&(w=v),r=w.reduce(function(e,t){return e+t.renderWidth},0)),t&&(t.style.width=r?"".concat(r+A,"px"):"",browse.msie&&_ctor.default.arrayEach(t.querySelectorAll(".vxe-resizable"),function(e){e.style.height="".concat(e.parentNode.offsetHeight,"px")}));var o=V["".concat(d,"-").concat(c,"-repair")];o&&(o.style.width="".concat(D,"px"));var i=V["".concat(d,"-").concat(c,"-list")];m&&i&&_ctor.default.arrayEach(i.querySelectorAll(".col--group"),function(e){var t=p.getColumnNode(e);if(t){var r=t.item,o=r.showHeaderOverflow,i=_ctor.default.isBoolean(o)?o:y,n="title"===i||(!0===i||"tooltip"===i)||"ellipsis"===i,l=0,a=0;n&&_ctor.default.eachTree(r.children,function(e){e.children&&r.children.length||a++,l+=e.renderWidth}),e.style.width=n?"".concat(l-a-(T?2:0),"px"):""}})}else if("body"===c){var n=V["".concat(d,"-").concat(c,"-emptyBlock")];if(e&&(b?e.style.maxHeight="".concat(f?b-_-(R?0:I):b-_,"px"):e.style.height=0<C?"".concat(f?(0<C?C-_-k:O)-(R?0:I):C-_-k,"px"):""),g){var l="right"===f,a=F["".concat(f,"List")];e&&(e.style.top="".concat(_,"px")),g.style.height="".concat((0<C?C-_-k:O)+_+k-I*(R?2:1),"px"),g.style.width="".concat(a.reduce(function(e,t){return e+t.renderWidth},l?A:0),"px")}var s=D;f&&E?s=(w=v).reduce(function(e,t){return e+t.renderWidth},0):$&&(f&&(w=v),s=w.reduce(function(e,t){return e+t.renderWidth},0)),t&&(t.style.width=s?"".concat(s,"px"):"",t.style.paddingRight=A&&f&&(browse["-moz"]||browse.safari)?"".concat(A,"px"):""),n&&(n.style.width=s?"".concat(s,"px"):"")}else if("footer"===c){var u=D;f&&E?u=(w=v).reduce(function(e,t){return e+t.renderWidth},0):$&&(f&&(w=v),u=w.reduce(function(e,t){return e+t.renderWidth},0)),e&&(g&&(e.style.top="".concat(0<C?C-k:O+_,"px")),e.style.marginTop="".concat(-I,"px")),t&&(t.style.width=u?"".concat(u+A,"px"):"")}var h=V["".concat(d,"-").concat(c,"-colgroup")];h&&_ctor.default.arrayEach(h.children,function(e){var t=e.getAttribute("name");if("col_gutter"===t&&(e.style.width="".concat(A,"px")),x[t]){var r,a=x[t].column,o=a.showHeaderOverflow,i=a.showFooterOverflow,n=a.showOverflow;e.style.width="".concat(a.renderWidth,"px");var s="title"===(r="header"===c?_ctor.default.isUndefined(o)||_ctor.default.isNull(o)?y:o:"footer"===c?_ctor.default.isUndefined(i)||_ctor.default.isNull(i)?S:i:_ctor.default.isUndefined(n)||_ctor.default.isNull(n)?E:n)||(!0===r||"tooltip"===r)||"ellipsis"===r,l=V["".concat(d,"-").concat(c,"-list")];"header"===c||"footer"===c?$&&!s&&(s=!0):!$&&!M||s||(s=!0),l&&_ctor.default.arrayEach(l.querySelectorAll(".".concat(a.id)),function(e){var t=parseInt(e.getAttribute("colspan")||1),r=e.querySelector(".vxe-cell"),o=a.renderWidth;if(r){if(1<t)for(var i=p.getColumnIndex(a),n=1;n<t;n++){var l=p.getColumns(i+n);l&&(o+=l.renderWidth)}r.style.width=s?"".concat(o-L*t,"px"):""}})}})})}),r&&this.setCurrentRow(r),o&&o.selected&&e.selected.row&&e.selected.column&&this.addColSdCls(),this.$nextTick()},checkScrolling:function(){var e=this.$refs,t=e.tableBody,r=e.leftContainer,o=e.rightContainer,i=t?t.$el:null;i&&(r&&_tools.DomTools[0<i.scrollLeft?"addClass":"removeClass"](r,"scrolling--middle"),o&&_tools.DomTools[i.clientWidth<i.scrollWidth-Math.ceil(i.scrollLeft)?"addClass":"removeClass"](o,"scrolling--middle"))},preventEvent:function(t,e,r,o,i){var n,l=this;return _vXETable.default.interceptor.get(e).some(function(e){return!1===e(Object.assign({$grid:l.$xegrid,$table:l,$event:t},r))})||o&&(n=o()),i&&i(),n},handleGlobalMousedownEvent:function(o){var i=this,n=this.$el,e=this.$refs,t=this.$toolbar,r=this.mouseConfig,l=this.editStore,a=this.ctxMenuStore,s=this.editOpts,c=this.filterStore,u=this.getRowNode,h=l.actived,d=e.ctxWrapper,f=e.filterWrapper,v=e.validTip;if(f&&(getEventTargetNode(o,n,"vxe-cell--filter").flag||getEventTargetNode(o,f.$el).flag||getEventTargetNode(o,document.body,"vxe-table--ignore-clear").flag||this.preventEvent(o,"event.clearFilter",c.args,this.closeFilter)),h.row){if(!1!==s.autoClear){var g=h.args.cell;g&&getEventTargetNode(o,g).flag||v&&getEventTargetNode(o,v.$el).flag||(!this.lastCallTime||this.lastCallTime+50<Date.now())&&(getEventTargetNode(o,document.body,"vxe-table--ignore-clear").flag||this.preventEvent(o,"event.clearActived",h.args,function(){var e;if("row"===s.mode){var t=getEventTargetNode(o,n,"vxe-body--row");e=!!t.flag&&u(t.targetElem).item!==h.args.row}else e=!getEventTargetNode(o,n,"col--edit").flag;if(e||(e=getEventTargetNode(o,n,"vxe-header--row").flag),e||(e=getEventTargetNode(o,n,"vxe-footer--row").flag),!e&&i.height&&!i.overflowY){var r=o.target;hasClass(r,"vxe-table--body-wrapper")&&(e=o.offsetY<r.clientHeight)}!e&&getEventTargetNode(o,n).flag||setTimeout(function(){return i.clearActived(o)})}))}}else r&&(getEventTargetNode(o,n).flag||d&&getEventTargetNode(o,d.$el).flag||t&&getEventTargetNode(o,t.$el).flag||(this.clearSelected(),getEventTargetNode(o,document.body,"vxe-table--ignore-areas-clear").flag||this.preventEvent(o,"event.clearAreas",{},function(){i.clearCellAreas(),i.clearCopyCellArea()})));a.visible&&d&&!getEventTargetNode(o,d.$el).flag&&this.closeMenu(),this.isActivated=getEventTargetNode(o,(this.$xegrid||this).$el).flag},handleGlobalBlurEvent:function(){this.closeFilter(),this.closeMenu()},handleGlobalMousewheelEvent:function(){this.closeTooltip(),this.closeMenu()},handleGlobalKeydownEvent:function(X){var q=this;this.isActivated&&this.preventEvent(X,"event.keydown",null,function(){var e,t=q.filterStore,r=q.isCtxMenu,o=q.ctxMenuStore,i=q.editStore,n=q.editOpts,l=q.editConfig,a=q.mouseConfig,s=q.mouseOpts,c=q.keyboardConfig,u=q.keyboardOpts,h=q.treeConfig,d=q.treeOpts,f=q.highlightCurrentRow,v=q.currentRow,g=q.bodyCtxMenu,p=i.selected,m=i.actived,x=X.keyCode,w=8===x,C=9===x,b=13===x,T=27===x,_=32===x,R=37===x,E=38===x,y=39===x,S=40===x,k=46===x,O=113===x,D=93===x,I=X.metaKey,A=X.ctrlKey,$=X.shiftKey,M=X.altKey,L=R||E||y||S,F=r&&o.visible&&(b||_||L),V=l&&m.column&&m.row;if(t.visible)T&&q.closeFilter();else{if(F)X.preventDefault(),o.showChild&&hasChildrenList(o.selected)?q.moveCtxMenu(X,x,o,"selectChild",37,!1,o.selected.children):q.moveCtxMenu(X,x,o,"selected",39,!0,q.ctxMenuList);else if(c&&a&&s.area&&q.handleKeyboardEvent)q.handleKeyboardEvent(X);else if(c&&_&&u.isChecked&&p.row&&p.column&&("checkbox"===p.column.type||"radio"===p.column.type))X.preventDefault(),"checkbox"===p.column.type?q.handleToggleCheckRowEvent(X,p.args):q.triggerRadioRowEvent(X,p.args);else if(T)q.closeMenu(),q.closeFilter(),m.row&&(e=m.args,q.clearActived(X),a&&s.selected&&q.$nextTick(function(){return q.handleSelected(e,X)}));else if(O)V||p.row&&p.column&&(X.preventDefault(),q.handleActived(p.args,X));else if(D)q._keyCtx=p.row&&p.column&&g.length,clearTimeout(q.keyCtxTimeout),q.keyCtxTimeout=setTimeout(function(){q._keyCtx=!1},1e3);else if(b&&!M&&c&&u.isEnter&&(p.row||m.row||h&&f&&v)){if(A)m.row&&(e=m.args,q.clearActived(X),a&&s.selected&&q.$nextTick(function(){return q.handleSelected(e,X)}));else if(p.row||m.row){var U=p.row?p.args:m.args;$?u.enterToTab?q.moveTabSelected(U,$,X):q.moveSelected(U,R,!0,y,!1,X):u.enterToTab?q.moveTabSelected(U,$,X):q.moveSelected(U,R,!1,y,!0,X)}else if(h&&f&&v){var N=v[d.children];if(N&&N.length){X.preventDefault();var H=N[0];e={$table:q,row:H},q.setTreeExpand(v,!0).then(function(){return q.scrollToRow(H)}).then(function(){return q.triggerCurrentRowEvent(X,e)})}}}else if(L&&c&&u.isArrow)V||(p.row&&p.column?q.moveSelected(p.args,R,E,y,S,X):(E||S)&&f&&q.moveCurrentRow(E,S,X));else if(C&&c&&u.isTab)p.row||p.column?q.moveTabSelected(p.args,$,X):(m.row||m.column)&&q.moveTabSelected(m.args,$,X);else if(c&&(k||(h&&f&&v?w&&u.isArrow:w))){if(!V){var B=u.delMethod,z=u.backMethod;if(u.isDel&&(p.row||p.column))B?B({row:p.row,rowIndex:q.getRowIndex(p.row),column:p.column,columnIndex:q.getColumnIndex(p.column),$table:q}):setCellValue(p.row,p.column,null),w&&(z?z({row:p.row,rowIndex:q.getRowIndex(p.row),column:p.column,columnIndex:q.getColumnIndex(p.column),$table:q}):q.handleActived(p.args,X));else if(w&&u.isArrow&&h&&f&&v){var P=_ctor.default.findTree(q.afterFullData,function(e){return e===v},d).parent;P&&(X.preventDefault(),e={$table:q,row:P},q.setTreeExpand(P,!1).then(function(){return q.scrollToRow(P)}).then(function(){return q.triggerCurrentRowEvent(X,e)}))}}}else if(c&&u.isEdit&&!A&&!I&&(_||48<=x&&x<=57||65<=x&&x<=90||96<=x&&x<=111||186<=x&&x<=192||219<=x&&x<=222)){var W=u.editMethod;p.column&&p.row&&(0,_tools.isEnableConf)(p.column.editRender)&&(n.activeMethod&&!n.activeMethod(p.args)||(W?W({row:p.row,rowIndex:q.getRowIndex(p.row),column:p.column,columnIndex:q.getColumnIndex(p.column),$table:q}):(setCellValue(p.row,p.column,null),q.handleActived(p.args,X))))}q.emitEvent("keydown",{},X)}})},handleGlobalPasteEvent:function(e){var t=this.isActivated,r=this.keyboardConfig,o=this.keyboardOpts,i=this.mouseConfig,n=this.mouseOpts,l=this.editStore,a=this.filterStore,s=l.actived;t&&!a.visible&&(s.row||s.column||r&&o.isClip&&i&&n.area&&this.handlePasteCellAreaEvent&&this.handlePasteCellAreaEvent(e),this.emitEvent("paste",{},e))},handleGlobalCopyEvent:function(e){var t=this.isActivated,r=this.keyboardConfig,o=this.keyboardOpts,i=this.mouseConfig,n=this.mouseOpts,l=this.editStore,a=this.filterStore,s=l.actived;t&&!a.visible&&(s.row||s.column||r&&o.isClip&&i&&n.area&&this.handleCopyCellAreaEvent&&this.handleCopyCellAreaEvent(e),this.emitEvent("copy",{},e))},handleGlobalCutEvent:function(e){var t=this.isActivated,r=this.keyboardConfig,o=this.keyboardOpts,i=this.mouseConfig,n=this.mouseOpts,l=this.editStore,a=this.filterStore,s=l.actived;t&&!a.visible&&(s.row||s.column||r&&o.isClip&&i&&n.area&&this.handleCutCellAreaEvent&&this.handleCutCellAreaEvent(e),this.emitEvent("cut",{},e))},handleGlobalResizeEvent:function(){this.closeMenu(),this.recalculate(!0),this.updateCellAreas()},handleTooltipLeaveMethod:function(){var e=this,t=this.tooltipOpts;return setTimeout(function(){e.tooltipActive||e.closeTooltip()},t.leaveDelay),!1},handleTargetEnterEvent:function(){clearTimeout(this.tooltipTimeout),this.tooltipActive=!0,this.closeTooltip()},handleTargetLeaveEvent:function(){var e=this,t=this.tooltipOpts;this.tooltipActive=!1,t.enterable?this.tooltipTimeout=setTimeout(function(){e.$refs.tooltip.isHover||e.closeTooltip()},t.leaveDelay):this.closeTooltip()},triggerHeaderHelpEvent:function(e,t){var r=t.column.titleHelp;if(r.message){var o=this.$refs,i=this.tooltipStore,n=o.tooltip,l=_tools.UtilTools.getFuncText(r.message);this.handleTargetEnterEvent(),i.visible=!0,n&&n.open(e.currentTarget,l)}},triggerHeaderTooltipEvent:function(e,t){var r=this.tooltipStore,o=t.column,i=e.currentTarget;this.handleTargetEnterEvent(),r.column===o&&r.visible||this.handleTooltip(e,i,i,null,t)},triggerBodyTooltipEvent:function(e,t){var r,o,i=this.editConfig,n=this.editOpts,l=this.editStore,a=this.tooltipStore,s=l.actived,c=t.row,u=t.column,h=e.currentTarget;(this.handleTargetEnterEvent(),i&&("row"===n.mode&&s.row===c||s.row===c&&s.column===u))||(a.column===u&&a.row===c&&a.visible||(u.treeNode?(r=h.querySelector(".vxe-tree-cell"),"html"===u.type&&(o=h.querySelector(".vxe-cell--html"))):o=h.querySelector("html"===u.type?".vxe-cell--html":".vxe-cell--label"),this.handleTooltip(e,h,r||h.children[0],o,t)))},triggerFooterTooltipEvent:function(e,t){var r=t.column,o=this.tooltipStore,i=e.currentTarget;this.handleTargetEnterEvent(),o.column===r&&o.visible||this.handleTooltip(e,i,i.querySelector(".vxe-cell--item")||i.children[0],null,t)},handleTooltip:function(e,t,r,o,i){i.cell=t;var n=this.$refs,l=this.tooltipOpts,a=this.tooltipStore,s=i.column,c=i.row,u=l.enabled,h=l.contentMethod,d=n.tooltip,f=h?h(i):null,v=h&&!_ctor.default.eqNull(f),g=v?f:("html"===s.type?r.innerText:r.textContent).trim(),p=r.scrollWidth>r.clientWidth;return g&&(u||v||p)&&(Object.assign(a,{row:c,column:s,visible:!0}),d&&d.open(p?r:o||r,_tools.UtilTools.formatText(g))),this.$nextTick()},openTooltip:function(e,t){var r=this.$refs.commTip;return r?r.open(e,t):this.$nextTick()},closeTooltip:function(){var e=this.$refs,t=this.tooltipStore,r=e.tooltip,o=e.commTip;return t.visible&&(Object.assign(t,{row:null,column:null,content:null,visible:!1}),r&&r.close()),o&&o.close(),this.$nextTick()},isAllCheckboxChecked:function(){return this.isAllSelected},isCheckboxIndeterminate:function(){return!this.isAllSelected&&this.isIndeterminate},getCheckboxIndeterminateRecords:function(){var e=this.treeConfig,t=this.treeIndeterminates;return e?t.slice(0):[]},handleDefaultSelectionChecked:function(){var t=this.fullDataRowIdData,e=this.checkboxOpts,r=e.checkAll,o=e.checkRowKeys;if(r)this.setAllCheckboxRow(!0);else if(o){var i=[];o.forEach(function(e){t[e]&&i.push(t[e].row)}),this.setCheckboxRow(i,!0)}},setCheckboxRow:function(e,t){var r=this;return e&&!_ctor.default.isArray(e)&&(e=[e]),e.forEach(function(e){return r.handleSelectRow({row:e},!!t)}),this.$nextTick()},isCheckedByCheckboxRow:function(e){var t=this.checkboxOpts.checkField;return t?_ctor.default.get(e,t):-1<this.selection.indexOf(e)},handleSelectRow:function(e,r){var o=this,i=e.row,n=this.selection,t=this.afterFullData,l=this.treeConfig,a=this.treeOpts,s=this.treeIndeterminates,c=this.checkboxOpts,u=c.checkField,h=c.checkStrictly,d=c.checkMethod;if(u)if(l&&!h){-1===r?(-1===s.indexOf(i)&&s.push(i),_ctor.default.set(i,u,!1)):_ctor.default.eachTree([i],function(t){i!==t&&d&&!d({row:t})||(_ctor.default.set(t,u,r),_ctor.default.remove(s,function(e){return e===t}),o.handleCheckboxReserveRow(i,r))},a);var f=_ctor.default.findTree(t,function(e){return e===i},a);if(f&&f.parent){var v,g=d?f.items.filter(function(e){return d({row:e})}):f.items;if(_ctor.default.find(f.items,function(e){return-1<s.indexOf(e)}))v=-1;else{var p=f.items.filter(function(e){return _ctor.default.get(e,u)});v=p.filter(function(e){return-1<g.indexOf(e)}).length===g.length||!(!p.length&&-1!==r)&&-1}return this.handleSelectRow({row:f.parent},v)}}else d&&!d({row:i})||(_ctor.default.set(i,u,r),this.handleCheckboxReserveRow(i,r));else if(l&&!h){-1===r?(-1===s.indexOf(i)&&s.push(i),_ctor.default.remove(n,function(e){return e===i})):_ctor.default.eachTree([i],function(t){i!==t&&d&&!d({row:t})||(r?n.push(t):_ctor.default.remove(n,function(e){return e===t}),_ctor.default.remove(s,function(e){return e===t}),o.handleCheckboxReserveRow(i,r))},a);var m=_ctor.default.findTree(t,function(e){return e===i},a);if(m&&m.parent){var x,w=d?m.items.filter(function(e){return d({row:e})}):m.items;if(_ctor.default.find(m.items,function(e){return-1<s.indexOf(e)}))x=-1;else{var C=m.items.filter(function(e){return-1<n.indexOf(e)});x=C.filter(function(e){return-1<w.indexOf(e)}).length===w.length||!(!C.length&&-1!==r)&&-1}return this.handleSelectRow({row:m.parent},x)}}else d&&!d({row:i})||(r?-1===n.indexOf(i)&&n.push(i):_ctor.default.remove(n,function(e){return e===i}),this.handleCheckboxReserveRow(i,r));this.checkSelectionStatus()},handleToggleCheckRowEvent:function(e,t){var r=this.selection,o=this.checkboxOpts.checkField,i=t.row,n=o?!_ctor.default.get(i,o):-1===r.indexOf(i);e?this.triggerCheckRowEvent(e,t,n):this.handleSelectRow(t,n)},triggerCheckRowEvent:function(e,t,r){var o=this.checkboxOpts.checkMethod;o&&!o({row:t.row})||(this.handleSelectRow(t,r),this.emitEvent("checkbox-change",Object.assign({records:this.getCheckboxRecords(),reserves:this.getCheckboxReserveRecords(),indeterminates:this.getCheckboxIndeterminateRecords(),checked:r},t),e))},toggleCheckboxRow:function(e){return this.handleToggleCheckRowEvent(null,{row:e}),this.$nextTick()},setAllCheckboxRow:function(t){var r=this,o=this.afterFullData,e=this.treeConfig,i=this.treeOpts,n=this.selection,l=this.checkboxReserveRowMap,a=this.checkboxOpts,s=a.checkField,c=a.reserve,u=a.checkStrictly,h=a.checkMethod,d=[],f=e?[]:n.filter(function(e){return-1===o.indexOf(e)});if(u)this.isAllSelected=t;else{if(s){var v=function(e){h&&!h({row:e})||(t&&d.push(e),_ctor.default.set(e,s,t))};e?_ctor.default.eachTree(o,v,i):o.forEach(v)}else e?t?_ctor.default.eachTree(o,function(e){h&&!h({row:e})||d.push(e)},i):h&&_ctor.default.eachTree(o,function(e){!h({row:e})&&-1<n.indexOf(e)&&d.push(e)},i):t?d=h?o.filter(function(e){return-1<n.indexOf(e)||h({row:e})}):o.slice(0):h&&(d=o.filter(function(e){return h({row:e})?0:-1<n.indexOf(e)}));c&&(t?d.forEach(function(e){l[getRowid(r,e)]=e}):o.forEach(function(e){return r.handleCheckboxReserveRow(e,!1)})),this.selection=s?[]:f.concat(d)}this.treeIndeterminates=[],this.checkSelectionStatus()},checkSelectionStatus:function(){var e=this.afterFullData,t=this.selection,r=this.treeIndeterminates,o=this.checkboxOpts,i=this.treeConfig,n=o.checkField,l=o.halfField,a=o.checkStrictly,s=o.checkMethod;if(!a){var c=!1,u=!1;u=n?(c=e.length&&e.every(s?function(e){return!s({row:e})||_ctor.default.get(e,n)}:function(e){return _ctor.default.get(e,n)}),i?l?!c&&e.some(function(e){return _ctor.default.get(e,n)||_ctor.default.get(e,l)||-1<r.indexOf(e)}):!c&&e.some(function(e){return _ctor.default.get(e,n)||-1<r.indexOf(e)}):l?!c&&e.some(function(e){return _ctor.default.get(e,n)||_ctor.default.get(e,l)}):!c&&e.some(function(e){return _ctor.default.get(e,n)})):(c=e.length&&e.every(s?function(e){return!s({row:e})||-1<t.indexOf(e)}:function(e){return-1<t.indexOf(e)}),i?!c&&e.some(function(e){return-1<r.indexOf(e)||-1<t.indexOf(e)}):!c&&e.some(function(e){return-1<t.indexOf(e)})),this.isAllSelected=c,this.isIndeterminate=u}},handleReserveStatus:function(){var e=this.expandColumn,t=this.treeOpts,r=this.treeConfig,o=this.fullDataRowIdData,i=this.fullAllDataRowMap,n=this.currentRow,l=this.selectRow,a=this.radioReserveRow,s=this.radioOpts,c=this.checkboxOpts,u=this.selection,h=this.rowExpandeds,d=this.treeExpandeds,f=this.expandOpts;if(l&&!i.has(l)&&(this.selectRow=null),s.reserve&&a){var v=getRowid(this,a);o[v]&&this.setRadioRow(o[v].row)}this.selection=getRecoverRow(this,u),c.reserve&&this.setCheckboxRow(handleReserveRow(this,this.checkboxReserveRowMap),!0),n&&!i.has(n)&&(this.currentRow=null),this.rowExpandeds=e?getRecoverRow(this,h):[],e&&f.reserve&&this.setRowExpand(handleReserveRow(this,this.rowExpandedReserveRowMap),!0),this.treeExpandeds=r?getRecoverRow(this,d):[],r&&t.reserve&&this.setTreeExpand(handleReserveRow(this,this.treeExpandedReserveRowMap),!0)},getRadioReserveRecord:function(){var e=this.fullDataRowIdData,t=this.radioReserveRow;return this.radioOpts.reserve&&t&&!e[getRowid(this,t)]?t:null},clearRadioReserve:function(){return this.radioReserveRow=null,this.$nextTick()},handleRadioReserveRow:function(e){this.radioOpts.reserve&&(this.radioReserveRow=e)},getCheckboxReserveRecords:function(){var r=this.fullDataRowIdData,e=this.checkboxReserveRowMap,t=this.checkboxOpts,o=[];return t.reserve&&_ctor.default.each(e,function(e,t){e&&!r[t]&&o.push(e)}),o},clearCheckboxReserve:function(){return this.checkboxReserveRowMap={},this.$nextTick()},handleCheckboxReserveRow:function(e,t){var r=this.checkboxReserveRowMap;if(this.checkboxOpts.reserve){var o=getRowid(this,e);t?r[o]=e:r[o]&&delete r[o]}},triggerCheckAllEvent:function(e,t){this.setAllCheckboxRow(t),this.emitEvent("checkbox-all",{records:this.getCheckboxRecords(),reserves:this.getCheckboxReserveRecords(),indeterminates:this.getCheckboxIndeterminateRecords(),checked:t},e)},toggleAllCheckboxRow:function(){return this.triggerCheckAllEvent(null,!this.isAllSelected),this.$nextTick()},clearCheckboxRow:function(){var t=this,e=this.tableFullData,r=this.treeConfig,o=this.treeOpts,i=this.checkboxOpts,n=i.checkField,l=i.reserve;return n&&(r?_ctor.default.eachTree(e,function(e){return _ctor.default.set(e,n,!1)},o):e.forEach(function(e){return _ctor.default.set(e,n,!1)})),l&&e.forEach(function(e){return t.handleCheckboxReserveRow(e,!1)}),this.isAllSelected=!1,this.isIndeterminate=!1,this.selection=[],this.treeIndeterminates=[],this.$nextTick()},handleDefaultRadioChecked:function(){var e=this.radioOpts,t=this.fullDataRowIdData,r=e.checkRowKey,o=e.reserve;if(r&&(t[r]&&this.setRadioRow(t[r].row),o)){var i=getRowkey(this);this.radioReserveRow=_defineProperty({},i,r)}},triggerRadioRowEvent:function(e,t){var r=this.selectRow!==t.row;this.setRadioRow(t.row),r&&this.emitEvent("radio-change",t,e)},triggerCurrentRowEvent:function(e,t){var r=this.currentRow!==t.row;this.setCurrentRow(t.row),r&&this.emitEvent("current-change",t,e)},setCurrentRow:function(e){return this.clearCurrentRow(),this.clearCurrentColumn(),this.currentRow=e,this.highlightCurrentRow&&_ctor.default.arrayEach(this.$el.querySelectorAll('[rowid="'.concat(getRowid(this,e),'"]')),function(e){return addClass(e,"row--current")}),this.$nextTick()},isCheckedByRadioRow:function(e){return this.selectRow===e},setRadioRow:function(e){var t=this.radioOpts.checkMethod;return!e||t&&!t({row:e})||(this.selectRow=e,this.handleRadioReserveRow(e)),this.$nextTick()},clearCurrentRow:function(){return this.currentRow=null,this.hoverRow=null,_ctor.default.arrayEach(this.$el.querySelectorAll(".row--current"),function(e){return removeClass(e,"row--current")}),this.$nextTick()},clearRadioRow:function(){return this.selectRow=null,this.$nextTick()},getCurrentRecord:function(){return this.highlightCurrentRow?this.currentRow:null},getRadioRecord:function(){return this.selectRow},triggerHoverEvent:function(e,t){var r=t.row;this.setHoverRow(r)},setHoverRow:function(e){var t=getRowid(this,e);this.clearHoverRow(),_ctor.default.arrayEach(this.$el.querySelectorAll('[rowid="'.concat(t,'"]')),function(e){return addClass(e,"row--hover")}),this.hoverRow=e},clearHoverRow:function(){_ctor.default.arrayEach(this.$el.querySelectorAll(".vxe-body--row.row--hover"),function(e){return removeClass(e,"row--hover")}),this.hoverRow=null},triggerHeaderCellClickEvent:function(e,t){var r=this._lastResizeTime,o=this.sortOpts,i=t.column,n=e.currentTarget,l=r&&r>Date.now()-300,a=getEventTargetNode(e,n,"vxe-cell--sort").flag,s=getEventTargetNode(e,n,"vxe-cell--filter").flag;return"cell"!==o.trigger||l||a||s||this.triggerSortEvent(e,i,getNextSortOrder(this,i)),this.emitEvent("header-cell-click",Object.assign({triggerResizable:l,triggerSort:a,triggerFilter:s,cell:n},t),e),this.highlightCurrentColumn?this.setCurrentColumn(i):this.$nextTick()},triggerHeaderCellDBLClickEvent:function(e,t){this.emitEvent("header-cell-dblclick",Object.assign({cell:e.currentTarget},t),e)},getCurrentColumn:function(){return this.highlightCurrentColumn?this.currentColumn:null},setCurrentColumn:function(e){var t=(0,_util.handleFieldOrColumn)(this,e);return t&&(this.clearCurrentRow(),this.clearCurrentColumn(),this.currentColumn=t),this.$nextTick()},clearCurrentColumn:function(){return this.currentColumn=null,this.$nextTick()},checkValidate:function(e){return _vXETable.default._valid?this.triggerValidate(e):this.$nextTick()},handleChangeCell:function(e,t){var r=this;this.checkValidate("blur").catch(function(e){return e}).then(function(){r.handleActived(t,e).then(function(){return r.checkValidate("change")}).catch(function(e){return e})})},triggerCellClickEvent:function(e,t){var r=this.highlightCurrentRow,o=this.editStore,i=this.radioOpts,n=this.expandOpts,l=this.treeOpts,a=this.editConfig,s=this.editOpts,c=this.checkboxOpts,u=o.actived,h=t,d=h.row,f=h.column,v=f.type,g=f.treeNode,p="radio"===v,m="checkbox"===v,x="expand"===v,w=e.currentTarget,C=p&&getEventTargetNode(e,w,"vxe-cell--radio").flag,b=m&&getEventTargetNode(e,w,"vxe-cell--checkbox").flag,T=g&&getEventTargetNode(e,w,"vxe-tree--btn-wrapper").flag,_=x&&getEventTargetNode(e,w,"vxe-table--expanded").flag;t=Object.assign({cell:w,triggerRadio:C,triggerCheckbox:b,triggerTreeNode:T,triggerExpandNode:_},t),!_&&("row"===n.trigger||x&&"cell"===n.trigger)&&this.triggerRowExpandEvent(e,t),("row"===l.trigger||g&&"cell"===l.trigger)&&this.triggerTreeExpandEvent(e,t),T||(_||(r&&(b||C||this.triggerCurrentRowEvent(e,t)),!C&&("row"===i.trigger||p&&"cell"===i.trigger)&&this.triggerRadioRowEvent(e,t),!b&&("row"===c.trigger||m&&"cell"===c.trigger)&&this.handleToggleCheckRowEvent(e,t)),a&&("manual"===s.trigger?u.args&&u.row===d&&f!==u.column&&this.handleChangeCell(e,t):u.args&&d===u.row&&f===u.column||("click"===s.trigger?this.handleChangeCell(e,t):"dblclick"===s.trigger&&"row"===s.mode&&u.row===d&&this.handleChangeCell(e,t)))),this.emitEvent("cell-click",t,e)},triggerCellDBLClickEvent:function(e,t){var r=this,o=this.editStore,i=this.editConfig,n=this.editOpts,l=o.actived,a=e.currentTarget;t.cell=a,i&&"dblclick"===n.trigger&&(l.args&&e.currentTarget===l.args.cell||("row"===n.mode?this.checkValidate("blur").catch(function(e){return e}).then(function(){r.handleActived(t,e).then(function(){return r.checkValidate("change")}).catch(function(e){return e})}):"cell"===n.mode&&this.handleActived(t,e).then(function(){return r.checkValidate("change")}).catch(function(e){return e}))),this.emitEvent("cell-dblclick",t,e)},handleDefaultSort:function(){var i=this,e=this.sortOpts,t=e.defaultSort;t&&(_ctor.default.isArray(t)||(t=[t]),t.length&&(t.forEach(function(e){var t=e.field,r=e.order;if(t&&r){var o=i.getColumnByField(t);o&&o.sortable&&(o.order=r)}}),e.remote||this.handleTableData(!0).then(this.updateStyle)))},triggerSortEvent:function(e,t,r){var o=this.sortOpts,i=t.property;if(t.sortable||t.remoteSort){r&&t.order!==r?this.sort({field:i,order:r}):this.clearSort(o.multiple?t:null);var n={column:t,property:i,order:t.order,sortBy:t.sortBy,sortList:this.getSortColumns()};this.emitEvent("sort-change",n,e)}},sort:function(e,t){var i,n=this,r=this.sortOpts,o=r.multiple,l=r.remote,a=r.orders;return e&&_ctor.default.isString(e)&&(e=[{field:e,order:t}]),_ctor.default.isArray(e)||(e=[e]),e.length?(o||clearAllSort(this),(o?e:[e[0]]).forEach(function(e){var t=e.field,r=e.order,o=t;_ctor.default.isString(t)&&(o=n.getColumnByField(t)),o&&(o.sortable||o.remoteSort)&&(i||(i=o),-1===a.indexOf(r)&&(r=getNextSortOrder(n,o)),o.order!==r&&(o.order=r))}),(!l||i&&i.remoteSort)&&this.handleTableData(!0),this.$nextTick().then(this.updateStyle)):this.$nextTick()},clearSort:function(e){var t=this.sortOpts;if(e){var r=(0,_util.handleFieldOrColumn)(this,e);r&&(r.order=null)}else clearAllSort(this);return t.remote?this.$nextTick():this.handleTableData(!0)},getSortColumn:function(){return"development"===process.env.VUE_APP_VXE_TABLE_ENV&&_tools.UtilTools.warn("vxe.error.delFunc",["getSortColumn","getSortColumns"]),_ctor.default.find(this.visibleColumn,function(e){return(e.sortable||e.remoteSort)&&e.order})},isSort:function(e){if(e){var t=(0,_util.handleFieldOrColumn)(this,e);return t&&t.sortable&&!!t.order}return 0<this.getSortColumns().length},getSortColumns:function(){var r=[];return this.visibleColumn.forEach(function(e){var t=e.order;(e.sortable||e.remoteSort)&&t&&r.push({column:e,sortBy:e.sortBy,property:e.property,order:t})}),r},closeFilter:function(){return Object.assign(this.filterStore,{isAllSelected:!1,isIndeterminate:!1,options:[],visible:!1}),this.$nextTick()},isFilter:function(e){var t=(0,_util.handleFieldOrColumn)(this,e);return t?t.filters&&t.filters.some(function(e){return e.checked}):0<this.getCheckedFilters().length},isRowExpandLoaded:function(e){var t=this.fullAllDataRowMap.get(e);return t&&t.expandLoaded},clearRowExpandLoaded:function(t){var e=this.expandOpts,r=this.expandLazyLoadeds,o=this.fullAllDataRowMap,i=e.lazy,n=o.get(t);return i&&n&&(n.expandLoaded=!1,_ctor.default.remove(r,function(e){return t===e})),this.$nextTick()},reloadExpandContent:function(e){var t=this,r=this.expandOpts,o=this.expandLazyLoadeds;return r.lazy&&-1===o.indexOf(e)&&this.clearRowExpandLoaded(e).then(function(){return t.handleAsyncRowExpand(e)}),this.$nextTick()},triggerRowExpandEvent:function(e,t){var r=this.expandOpts,o=this.expandLazyLoadeds,i=this.expandColumn,n=t.row;if(!r.lazy||-1===o.indexOf(n)){var l=!this.isExpandByRow(n),a=this.getColumnIndex(i),s=this.getVMColumnIndex(i);this.setRowExpand(n,l),this.emitEvent("toggle-row-expand",{expanded:l,column:i,columnIndex:a,$columnIndex:s,row:n,rowIndex:this.getRowIndex(n),$rowIndex:this.getVMRowIndex(n)},e)}},toggleRowExpand:function(e){return this.setRowExpand(e,!this.isExpandByRow(e))},handleDefaultRowExpand:function(){var e=this.expandOpts,t=this.fullDataRowIdData,r=e.expandAll,o=e.expandRowKeys;if(r)this.setAllRowExpand(!0);else if(o){var i=[];o.forEach(function(e){t[e]&&i.push(t[e].row)}),this.setRowExpand(i,!0)}},setAllRowExpand:function(e){return this.setRowExpand(this.expandOpts.lazy?this.tableData:this.tableFullData,e)},handleAsyncRowExpand:function(t){var r=this,o=this.fullAllDataRowMap.get(t);return new Promise(function(e){r.expandLazyLoadeds.push(t),r.expandOpts.loadMethod({$table:r,row:t,rowIndex:r.getRowIndex(t),$rowIndex:r.getVMRowIndex(t)}).catch(function(e){return e}).then(function(){o.expandLoaded=!0,_ctor.default.remove(r.expandLazyLoadeds,function(e){return e===t}),r.rowExpandeds.push(t),e(r.$nextTick().then(r.recalculate))})})},setRowExpand:function(e,t){var r=this,o=this.fullAllDataRowMap,i=this.expandLazyLoadeds,n=this.expandOpts,l=this.expandColumn,a=this.rowExpandeds,s=n.reserve,c=n.lazy,u=n.accordion,h=n.toggleMethod,d=[],f=this.getColumnIndex(l),v=this.getVMColumnIndex(l);if(e){_ctor.default.isArray(e)||(e=[e]),u&&(a=[],e=e.slice(e.length-1,e.length));var g=h?e.filter(function(e){return h({expanded:t,column:l,columnIndex:f,$columnIndex:v,row:e,rowIndex:r.getRowIndex(e),$rowIndex:r.getVMRowIndex(e)})}):e;t?g.forEach(function(e){if(-1===a.indexOf(e)){var t=o.get(e);c&&!t.expandLoaded&&-1===i.indexOf(e)?d.push(r.handleAsyncRowExpand(e)):a.push(e)}}):_ctor.default.remove(a,function(e){return-1<g.indexOf(e)}),s&&g.forEach(function(e){return r.handleRowExpandReserve(e,t)})}return this.rowExpandeds=a,Promise.all(d).then(this.recalculate)},isExpandByRow:function(e){return-1<this.rowExpandeds.indexOf(e)},clearRowExpand:function(){var t=this,e=this.expandOpts,r=this.rowExpandeds,o=this.tableFullData,i=e.reserve,n=r.length;return this.rowExpandeds=[],i&&o.forEach(function(e){return t.handleRowExpandReserve(e,!1)}),this.$nextTick().then(function(){n&&t.recalculate()})},clearRowExpandReserve:function(){return this.rowExpandedReserveRowMap={},this.$nextTick()},handleRowExpandReserve:function(e,t){var r=this.rowExpandedReserveRowMap;if(this.expandOpts.reserve){var o=getRowid(this,e);t?r[o]=e:r[o]&&delete r[o]}},getRowExpandRecords:function(){return this.rowExpandeds.slice(0)},getTreeExpandRecords:function(){return this.treeExpandeds.slice(0)},getTreeStatus:function(){return this.treeConfig?{config:this.treeOpts,rowExpandeds:this.getTreeExpandRecords()}:null},isTreeExpandLoaded:function(e){var t=this.fullAllDataRowMap.get(e);return t&&t.treeLoaded},clearTreeExpandLoaded:function(t){var e=this.treeOpts,r=this.treeExpandeds,o=this.fullAllDataRowMap,i=e.lazy,n=o.get(t);return i&&n&&(n.treeLoaded=!1,_ctor.default.remove(r,function(e){return t===e})),this.$nextTick()},reloadTreeChilds:function(e){var t=this,r=this.treeOpts,o=this.treeLazyLoadeds,i=r.lazy,n=r.hasChild;return i&&e[n]&&-1===o.indexOf(e)&&this.clearTreeExpandLoaded(e).then(function(){return t.handleAsyncTreeExpandChilds(e)}),this.$nextTick()},triggerTreeExpandEvent:function(e,t){var r=this.treeOpts,o=this.treeLazyLoadeds,i=t.row,n=t.column;if(!r.lazy||-1===o.indexOf(i)){var l=!this.isTreeExpandByRow(i),a=this.getColumnIndex(n),s=this.getVMColumnIndex(n);this.setTreeExpand(i,l),this.emitEvent("toggle-tree-expand",{expanded:l,column:n,columnIndex:a,$columnIndex:s,row:i},e)}},toggleTreeExpand:function(e){return this.setTreeExpand(e,!this.isTreeExpandByRow(e))},handleDefaultTreeExpand:function(){var e=this.treeConfig,r=this.treeOpts,o=this.tableFullData;if(e){var t=r.expandAll,i=r.expandRowKeys;if(t)this.setAllTreeExpand(!0);else if(i){var n=[],l=getRowkey(this);i.forEach(function(t){var e=_ctor.default.findTree(o,function(e){return t===_ctor.default.get(e,l)},r);e&&n.push(e.item)}),this.setTreeExpand(n,!0)}}},handleAsyncTreeExpandChilds:function(r){var o=this,e=this.fullAllDataRowMap,i=this.treeExpandeds,t=this.treeOpts,n=this.treeLazyLoadeds,l=this.checkboxOpts,a=t.loadMethod,s=l.checkStrictly,c=e.get(r);return new Promise(function(t){n.push(r),a({$table:o,row:r}).catch(function(){return[]}).then(function(e){c.treeLoaded=!0,_ctor.default.remove(n,function(e){return e===r}),_ctor.default.isArray(e)||(e=[]),e&&o.loadChildren(r,e).then(function(e){e.length&&-1===i.indexOf(r)&&i.push(r),!s&&o.isCheckedByCheckboxRow(r)&&o.setCheckboxRow(e,!0)}),t(o.$nextTick().then(o.recalculate))})})},setAllTreeExpand:function(e){var t=this.tableFullData,r=this.treeOpts,o=r.lazy,i=r.children,n=[];return _ctor.default.eachTree(t,function(e){var t=e[i];(o||t&&t.length)&&n.push(e)},r),this.setTreeExpand(n,e)},setTreeExpand:function(e,t){var r=this,o=this.fullAllDataRowMap,i=this.tableFullData,n=this.treeExpandeds,l=this.treeOpts,a=this.treeLazyLoadeds,s=this.treeNodeColumn,c=l.reserve,u=l.lazy,h=l.hasChild,d=l.children,f=l.accordion,v=l.toggleMethod,g=[],p=this.getColumnIndex(s),m=this.getVMColumnIndex(s);if(e&&(_ctor.default.isArray(e)||(e=[e]),e.length)){var x=v?e.filter(function(e){return v({expanded:t,column:s,columnIndex:p,$columnIndex:m,row:e})}):e;if(f){x=x.length?[x[x.length-1]]:[];var w=_ctor.default.findTree(i,function(e){return e===x[0]},l);w&&_ctor.default.remove(n,function(e){return-1<w.items.indexOf(e)})}return t?x.forEach(function(e){if(-1===n.indexOf(e)){var t=o.get(e);u&&e[h]&&!t.treeLoaded&&-1===a.indexOf(e)?g.push(r.handleAsyncTreeExpandChilds(e)):e[d]&&e[d].length&&n.push(e)}}):_ctor.default.remove(n,function(e){return-1<x.indexOf(e)}),c&&x.forEach(function(e){return r.handleTreeExpandReserve(e,t)}),Promise.all(g).then(this.recalculate)}return this.$nextTick()},isTreeExpandByRow:function(e){return-1<this.treeExpandeds.indexOf(e)},clearTreeExpand:function(){var t=this,e=this.treeOpts,r=this.treeExpandeds,o=this.tableFullData,i=e.reserve,n=r.length;return this.treeExpandeds=[],i&&_ctor.default.eachTree(o,function(e){return t.handleTreeExpandReserve(e,!1)},e),this.$nextTick().then(function(){n&&t.recalculate()})},clearTreeExpandReserve:function(){return this.treeExpandedReserveRowMap={},this.$nextTick()},handleTreeExpandReserve:function(e,t){var r=this.treeExpandedReserveRowMap;if(this.treeOpts.reserve){var o=getRowid(this,e);t?r[o]=e:r[o]&&delete r[o]}},getScroll:function(){var e=this.$refs,t=this.scrollXLoad,r=this.scrollYLoad,o=e.tableBody.$el;return{virtualX:t,virtualY:r,scrollTop:o.scrollTop,scrollLeft:o.scrollLeft}},triggerScrollXEvent:function(){this.loadScrollXData()},loadScrollXData:function(){var e=this.mergeList,t=this.mergeFooterList,r=this.scrollXStore,o=r.startIndex,i=r.endIndex,n=r.offsetSize,l=computeVirtualX(this),a=l.toVisibleIndex,s=l.visibleSize,c={startIndex:Math.max(0,a-1-n),endIndex:a+s+n};calculateMergerOffserIndex(e.concat(t),c,"col");var u=c.startIndex,h=c.endIndex;(a<=o||i-s-1<=a)&&(o===u&&i===h||(r.startIndex=u,r.endIndex=h,this.updateScrollXData())),this.closeTooltip()},triggerScrollYEvent:function(e){var t=this.scrollYStore,r=t.adaptive,o=t.offsetSize,i=t.visibleSize;isWebkit&&r&&2*o+i<=40?this.loadScrollYData(e):this.debounceScrollY(e)},debounceScrollY:_ctor.default.debounce(function(e){this.loadScrollYData(e)},debounceScrollYDuration,{leading:!1,trailing:!0}),loadScrollYData:function(e){var t=this.mergeList,r=this.scrollYStore,o=r.startIndex,i=r.endIndex,n=r.visibleSize,l=r.offsetSize,a=r.rowHeight,s=e.target.scrollTop,c=Math.floor(s/a),u={startIndex:Math.max(0,c-1-l),endIndex:c+n+l};calculateMergerOffserIndex(t,u,"row");var h=u.startIndex,d=u.endIndex;(c<=o||i-n-1<=c)&&(o===h&&i===d||(r.startIndex=h,r.endIndex=d,this.updateScrollYData()))},computeScrollLoad:function(){var d=this;return this.$nextTick().then(function(){var e=d.sYOpts,t=d.sXOpts,r=d.scrollXLoad,o=d.scrollYLoad,i=d.scrollXStore,n=d.scrollYStore;if(r){var l=computeVirtualX(d).visibleSize,a=t.oSize?_ctor.default.toNumber(t.oSize):browse.msie?10:browse.edge?5:0;i.offsetSize=a,i.visibleSize=l,i.endIndex=Math.max(i.startIndex+i.visibleSize+a,i.endIndex),d.updateScrollXData()}else d.updateScrollXSpace();var s=computeVirtualY(d),c=s.rowHeight,u=s.visibleSize;if(n.rowHeight=c,o){var h=e.oSize?_ctor.default.toNumber(e.oSize):browse.msie?20:browse.edge?10:0;n.offsetSize=h,n.visibleSize=u,n.endIndex=Math.max(n.startIndex+u+h,n.endIndex),d.updateScrollYData()}else d.updateScrollYSpace();d.rowHeight=c,d.$nextTick(d.updateStyle)})},handleTableColumn:function(){var e=this.scrollXLoad,t=this.visibleColumn,r=this.scrollXStore;this.tableColumn=e?t.slice(r.startIndex,r.endIndex):t.slice(0)},updateScrollXData:function(){this.handleTableColumn(),this.updateScrollXSpace()},updateScrollXSpace:function(){var e=this.$refs,o=this.elemStore,t=this.visibleColumn,r=this.scrollXStore,i=this.scrollXLoad,n=this.tableWidth,l=this.scrollbarWidth,a=e.tableHeader,s=e.tableBody,c=e.tableFooter,u=s?s.$el:null;if(u){var h=a?a.$el:null,d=c?c.$el:null,f=h?h.querySelector(".vxe-table--header"):null,v=u.querySelector(".vxe-table--body"),g=d?d.querySelector(".vxe-table--footer"):null,p=t.slice(0,r.startIndex).reduce(function(e,t){return e+t.renderWidth},0),m="";i&&(m="".concat(p,"px")),f&&(f.style.marginLeft=m),v.style.marginLeft=m,g&&(g.style.marginLeft=m);["main"].forEach(function(r){["header","body","footer"].forEach(function(e){var t=o["".concat(r,"-").concat(e,"-xSpace")];t&&(t.style.width=i?"".concat(n+("header"===e?l:0),"px"):"")})}),this.$nextTick(this.updateStyle)}},updateScrollYData:function(){this.handleTableData(),this.updateScrollYSpace()},updateScrollYSpace:function(){var o=this.elemStore,e=this.scrollYStore,t=this.scrollYLoad,r=this.afterFullData,i=e.startIndex,n=e.rowHeight,l=r.length*n,a=Math.max(0,i*n),s="",c="";t&&(s="".concat(a,"px"),c="".concat(l,"px")),["main","left","right"].forEach(function(r){var e=o["".concat(r,"-body-table")];e&&(e.style.marginTop=s),["header","body","footer"].forEach(function(e){var t=o["".concat(r,"-").concat(e,"-ySpace")];t&&(t.style.height=c)})}),this.$nextTick(this.updateStyle)},scrollTo:function(e,t){var r=this,o=this.$refs,i=o.tableBody,n=o.rightBody,l=o.tableFooter,a=i?i.$el:null,s=(n?n.$el:null)||a,c=(l?l.$el:null)||a;return c&&_ctor.default.isNumber(e)&&(c.scrollLeft=e),s&&_ctor.default.isNumber(t)&&(s.scrollTop=t),this.scrollXLoad||this.scrollYLoad?new Promise(function(e){return setTimeout(function(){return e(r.$nextTick())},50)}):this.$nextTick()},scrollToRow:function(e,t){var r=[];return e&&(this.treeConfig?r.push(this.scrollToTreeRow(e)):r.push(_tools.DomTools.rowToVisible(this,e))),t&&r.push(this.scrollToColumn(t)),Promise.all(r)},scrollToColumn:function(e){var t=(0,_util.handleFieldOrColumn)(this,e);return t&&this.fullColumnMap.has(t)?_tools.DomTools.colToVisible(this,t):this.$nextTick()},scrollToTreeRow:function(t){var r=this,e=this.tableFullData,o=this.treeConfig,i=this.treeOpts;if(o){var n=_ctor.default.findTree(e,function(e){return e===t},i);if(n){var l=n.nodes;l.forEach(function(e,t){t<l.length-1&&!r.isTreeExpandByRow(e)&&r.setTreeExpand(e,!0)})}}return this.$nextTick()},clearScroll:function(){var e=this.$refs,t=e.tableBody,r=e.rightBody,o=e.tableFooter,i=t?t.$el:null,n=r?r.$el:null,l=o?o.$el:null;return n&&(n.scrollTop=0),l&&(l.scrollLeft=0),i&&(i.scrollTop=0,i.scrollLeft=0),this.$nextTick()},updateFooter:function(){var e=this.showFooter,t=this.visibleColumn,r=this.footerMethod;return e&&r&&(this.footerData=t.length?r({columns:t,data:this.afterFullData,$table:this,$grid:this.$xegrid}):[]),this.$nextTick()},updateStatus:function(l,a){var s=this,c=!_ctor.default.isUndefined(a);return this.$nextTick().then(function(){var e=s.$refs,t=s.editRules,r=s.validStore;if(l&&e.tableBody&&t){var o=l.row,i=l.column;if(s.hasCellRules("change",o,i)){var n=s.getCell(o,i);if(n)return s.validCellRules("change",o,i,a).then(function(){c&&r.visible&&setCellValue(o,i,a),s.clearValidate()}).catch(function(e){var t=e.rule;c&&setCellValue(o,i,a),s.showValidTooltip({rule:t,row:o,column:i,cell:n})})}}})},handleDefaultMergeCells:function(){this.setMergeCells(this.mergeCells)},setMergeCells:function(e){var t=this;return this.spanMethod&&_tools.UtilTools.error("vxe.error.errConflicts",["merge-cells","span-method"]),setMerges(this,e,this.mergeList,this.afterFullData),this.$nextTick().then(function(){return t.updateCellAreas()})},removeMergeCells:function(e){var t=this;this.spanMethod&&_tools.UtilTools.error("vxe.error.errConflicts",["merge-cells","span-method"]);var r=removeMerges(this,e,this.mergeList,this.afterFullData);return this.$nextTick().then(function(){return t.updateCellAreas(),r})},getMergeCells:function(){return this.mergeList.slice(0)},clearMergeCells:function(){return this.mergeList=[],this.$nextTick()},handleDefaultMergeFooterItems:function(){this.setMergeFooterItems(this.mergeFooterItems)},setMergeFooterItems:function(e){var t=this;return this.footerSpanMethod&&_tools.UtilTools.error("vxe.error.errConflicts",["merge-footer-items","footer-span-method"]),setMerges(this,e,this.mergeFooterList,null),this.$nextTick().then(function(){return t.updateCellAreas()})},removeMergeFooterItems:function(e){var t=this;this.footerSpanMethod&&_tools.UtilTools.error("vxe.error.errConflicts",["merge-footer-items","footer-span-method"]);var r=removeMerges(this,e,this.mergeFooterList,null);return this.$nextTick().then(function(){return t.updateCellAreas(),r})},getMergeFooterItems:function(){return this.mergeFooterList.slice(0)},clearMergeFooterItems:function(){return this.mergeFooterList=[],this.$nextTick()},updateZindex:function(){this.zIndex?this.tZindex=this.zIndex:this.tZindex<_tools.UtilTools.getLastZIndex()&&(this.tZindex=_tools.UtilTools.nextZIndex())},updateCellAreas:function(){var e=this;this.recalculate().then(function(){return e.refreshScroll()}).then(function(){e.mouseConfig&&e.mouseOpts.area&&e.handleUpdateCellAreas&&e.handleUpdateCellAreas()})},emitEvent:function(e,t,r){this.$emit(e,Object.assign({$table:this,$grid:this.$xegrid,$event:r},t))},focus:function(){return this.isActivated=!0,this.$nextTick()},blur:function(){return this.isActivated=!1,this.$nextTick()},connect:function(e){return e&&e.syncUpdate?(e.syncUpdate({collectColumn:this.collectColumn,$table:this}),this.$toolbar=e):_tools.UtilTools.error("vxe.error.barUnableLink"),this.$nextTick()},getCell:function(e,t){var r=this.$refs,o=getRowid(this,e),i=r["".concat(t.fixed||"table","Body")]||r.tableBody;return i&&i.$el?i.$el.querySelector('.vxe-body--row[rowid="'.concat(o,'"] .').concat(t.id)):null},getCellLabel:function(e,t){var r=t.formatter,o=_tools.UtilTools.getCellValue(e,t),i=o;if(r){var n,l,a=this.fullAllDataRowMap,s=t.id;if(a.has(e)&&((l=(n=a.get(e)).formatData)||(l=a.get(e).formatData={}),n&&l[s]&&l[s].value===o))return l[s].label;var c={cellValue:o,row:e,rowIndex:this.getRowIndex(e),column:t,columnIndex:this.getColumnIndex(t)};if(_ctor.default.isString(r)){var u=_formats.default.get(r);i=u?u(c):""}else if(_ctor.default.isArray(r)){var h=_formats.default.get(r[0]);i=h?h.apply(void 0,[c].concat(_toConsumableArray(r.slice(1)))):""}else i=r(c);l&&(l[s]={value:o,label:i})}return i}},funcs="setFilter,clearFilter,getCheckedFilters,closeMenu,setActiveCellArea,getActiveCellArea,getCellAreas,clearCellAreas,copyCellArea,cutCellArea,pasteCellArea,getCopyCellArea,clearCopyCellArea,setCellAreas,openFind,openReplace,getSelectedCell,clearSelected,insert,insertAt,remove,removeCheckboxRow,removeRadioRow,removeCurrentRow,getRecordset,getInsertRecords,getRemoveRecords,getUpdateRecords,clearActived,getActiveRecord,isActiveByRow,setActiveRow,setActiveCell,setSelectCell,clearValidate,fullValidate,validate,openExport,openPrint,exportData,openImport,importData,saveFile,readFile,importByFile,print".split(",");funcs.forEach(function(e){Methods[e]=function(){return this["_".concat(e)]?this["_".concat(e)].apply(this,arguments):null}});var _default=Methods;exports.default=_default;