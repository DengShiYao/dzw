"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.Cell=void 0;var _ctor=_interopRequireDefault(require("xe-utils/ctor")),_conf=_interopRequireDefault(require("../../conf")),_vXETable=_interopRequireDefault(require("../../v-x-e-table")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function renderHelpIcon(e,r){var l=r.$table,t=r.column.titleHelp;return t?[e("i",{class:["vxe-cell-help-icon",t.icon||_conf.default.icon.TABLE_HELP],on:{mouseenter:function(e){l.triggerHeaderHelpEvent(e,r)},mouseleave:function(e){l.handleTargetLeaveEvent(e)}}})]:[]}function renderTitleContent(e,r,l){var t=r.$table,n=r.column,o=n.showHeaderOverflow,c=t.showHeaderOverflow,a=t.tooltipOpts,d=a.showAll||a.enabled,i=_ctor.default.isUndefined(o)||_ctor.default.isNull(o)?c:o,s="title"===i,u=!0===i||"tooltip"===i,f={};return(s||u||d)&&(f.mouseenter=function(e){t._isResize||(s?_tools.DomTools.updateCellTitle(e.currentTarget,n):(u||d)&&t.triggerHeaderTooltipEvent(e,r))}),(u||d)&&(f.mouseleave=function(e){t._isResize||(u||d)&&t.handleTargetLeaveEvent(e)}),[e("span",{class:"vxe-cell--title",on:f},l)]}function getFooterContent(e,r){var l=r.$table,t=r.column,n=r._columnIndex,o=r.items,c=t.slots,a=t.editRender,d=t.cellRender,i=a||d;if(c&&c.footer)return l.callSlot(c.footer,r,e);if(i){var s=_vXETable.default.renderer.get(i.name);if(s&&s.renderFooter)return s.renderFooter.call(l,e,i,r)}return[_tools.UtilTools.formatText(o[n],1)]}function getDefaultCellLabel(e){var r=e.$table,l=e.row,t=e.column;return _tools.UtilTools.formatText(r.getCellLabel(l,t),1)}var Cell={createColumn:function(e,r){var l=r.type,t=r.sortable,n=r.remoteSort,o=r.filters,c=r.editRender,a=r.treeNode,d=e.editConfig,i=e.editOpts,s=e.checkboxOpts,u={renderHeader:this.renderDefaultHeader,renderCell:a?this.renderTreeCell:this.renderDefaultCell,renderFooter:this.renderDefaultFooter};switch(l){case"seq":u.renderHeader=this.renderIndexHeader,u.renderCell=a?this.renderTreeIndexCell:this.renderIndexCell;break;case"radio":u.renderHeader=this.renderRadioHeader,u.renderCell=a?this.renderTreeRadioCell:this.renderRadioCell;break;case"checkbox":u.renderHeader=this.renderSelectionHeader,u.renderCell=s.checkField?a?this.renderTreeSelectionCellByProp:this.renderSelectionCellByProp:a?this.renderTreeSelectionCell:this.renderSelectionCell;break;case"expand":u.renderCell=this.renderExpandCell,u.renderData=this.renderExpandData;break;case"html":u.renderCell=a?this.renderTreeHTMLCell:this.renderHTMLCell,o&&(t||n)?u.renderHeader=this.renderSortAndFilterHeader:t||n?u.renderHeader=this.renderSortHeader:o&&(u.renderHeader=this.renderFilterHeader);break;default:d&&c?(u.renderHeader=this.renderEditHeader,u.renderCell="cell"===i.mode?a?this.renderTreeCellEdit:this.renderCellEdit:a?this.renderTreeRowEdit:this.renderRowEdit):o&&(t||n)?u.renderHeader=this.renderSortAndFilterHeader:t||n?u.renderHeader=this.renderSortHeader:o&&(u.renderHeader=this.renderFilterHeader)}return _tools.UtilTools.getColumnConfig(e,r,u)},renderHeaderTitle:function(e,r){var l=r.$table,t=r.column,n=t.slots,o=t.editRender,c=t.cellRender,a=o||c;if(n&&n.header)return renderTitleContent(e,r,l.callSlot(n.header,r,e));if(a){var d=_vXETable.default.renderer.get(a.name);if(d&&d.renderHeader)return renderTitleContent(e,r,d.renderHeader.call(l,e,a,r))}return renderTitleContent(e,r,_tools.UtilTools.formatText(t.getTitle(),1))},renderDefaultHeader:function(e,r){return renderHelpIcon(e,r).concat(Cell.renderHeaderTitle(e,r))},renderDefaultCell:function(e,r){var l=r.$table,t=r.column,n=t.slots,o=t.editRender,c=t.cellRender,a=o||c;if(n&&n.default)return l.callSlot(n.default,r,e);if(a){var d=o?"renderCell":"renderDefault",i=_vXETable.default.renderer.get(a.name);if(i&&i[d])return i[d].call(l,e,a,Object.assign({$type:o?"edit":"cell"},r))}return[e("span",{class:"vxe-cell--label"},[getDefaultCellLabel(r)])]},renderTreeCell:function(e,r){return Cell.renderTreeIcon(e,r,Cell.renderDefaultCell.call(this,e,r))},renderDefaultFooter:function(e,r){return[e("span",{class:"vxe-cell--item"},getFooterContent(e,r))]},renderTreeIcon:function(e,r,l){var t=r.$table,n=r.isHidden,o=t.treeOpts,c=t.treeExpandeds,a=t.treeLazyLoadeds,d=r.row,i=r.column,s=r.level,u=i.slots,f=o.children,x=o.hasChild,v=o.indent,h=o.lazy,C=o.trigger,b=o.iconLoaded,p=o.showIcon,T=o.iconOpen,E=o.iconClose,_=d[f],k=!1,m=!1,H=!1,g={};return u&&u.icon?t.callSlot(u.icon,r,e,l):(n||(m=-1<c.indexOf(d),h&&(H=-1<a.indexOf(d),k=d[x])),C&&"default"!==C||(g.click=function(e){return t.triggerTreeExpandEvent(e,r)}),[e("div",{class:["vxe-cell--tree-node",{"is--active":m}],style:{paddingLeft:"".concat(s*v,"px")}},[p&&(_&&_.length||k)?[e("div",{class:"vxe-tree--btn-wrapper",on:g},[e("i",{class:["vxe-tree--node-btn",H?b||_conf.default.icon.TABLE_TREE_LOADED:m?T||_conf.default.icon.TABLE_TREE_OPEN:E||_conf.default.icon.TABLE_TREE_CLOSE]})])]:null,e("div",{class:"vxe-tree-cell"},l)])])},renderIndexHeader:function(e,r){var l=r.$table,t=r.column,n=t.slots;return renderTitleContent(e,r,n&&n.header?l.callSlot(n.header,r,e):_tools.UtilTools.formatText(t.getTitle(),1))},renderIndexCell:function(e,r){var l=r.$table,t=r.column,n=l.seqOpts,o=t.slots;if(o&&o.default)return l.callSlot(o.default,r,e);var c=r.$seq,a=r.seq,d=r.level,i=n.seqMethod;return[_tools.UtilTools.formatText(i?i(r):d?"".concat(c,".").concat(a):n.startIndex+a,1)]},renderTreeIndexCell:function(e,r){return Cell.renderTreeIcon(e,r,Cell.renderIndexCell(e,r))},renderRadioHeader:function(e,r){var l=r.$table,t=r.column,n=t.slots;return renderTitleContent(e,r,n&&n.header?l.callSlot(n.header,r,e):[e("span",{class:"vxe-radio--label"},_tools.UtilTools.formatText(t.getTitle(),1))])},renderRadioCell:function(e,r){var l,t=r.$table,n=r.column,o=r.isHidden,c=t.radioOpts,a=t.selectRow,d=n.slots,i=c.labelField,s=c.checkMethod,u=r.row,f=u===a,x=!!s;return o||(l={click:function(e){x||t.triggerRadioRowEvent(e,r)}},s&&(x=!s({row:u}))),[e("span",{class:["vxe-cell--radio",{"is--checked":f,"is--disabled":x}],on:l},[e("span",{class:"vxe-radio--icon vxe-radio--checked-icon"}),e("span",{class:"vxe-radio--icon vxe-radio--unchecked-icon"})].concat(d&&d.default?t.callSlot(d.default,r,e):i?[e("span",{class:"vxe-radio--label"},_ctor.default.get(u,i))]:[]))]},renderTreeRadioCell:function(e,r){return Cell.renderTreeIcon(e,r,Cell.renderRadioCell(e,r))},renderSelectionHeader:function(e,r){var l,t=r.$table,n=r.column,o=r.isHidden,c=t.isIndeterminate,a=t.isAllCheckboxDisabled,d=n.slots,i=t.checkboxOpts,s=n.getTitle(),u=!1;return(i.checkStrictly?i.showHeader:!1!==i.showHeader)?(o||(u=!a&&t.isAllSelected,l={click:function(e){a||t.triggerCheckAllEvent(e,!u)}}),renderTitleContent(e,r,[e("span",{class:["vxe-cell--checkbox",{"is--checked":u,"is--disabled":a,"is--indeterminate":c}],attrs:{title:_conf.default.i18n("vxe.table.allTitle")},on:l},[e("span",{class:"vxe-checkbox--icon vxe-checkbox--checked-icon"}),e("span",{class:"vxe-checkbox--icon vxe-checkbox--unchecked-icon"}),e("span",{class:"vxe-checkbox--icon vxe-checkbox--indeterminate-icon"})].concat(d&&d.header?t.callSlot(d.header,r,e):s?[e("span",{class:"vxe-checkbox--label"},s)]:[]))])):renderTitleContent(e,r,d&&d.header?t.callSlot(d.header,r,e):[e("span",{class:"vxe-checkbox--label"},s)])},renderSelectionCell:function(e,r){var l,t=r.$table,n=r.row,o=r.column,c=r.isHidden,a=t.treeConfig,d=t.treeIndeterminates,i=t.checkboxOpts,s=i.labelField,u=i.checkMethod,f=o.slots,x=!1,v=!1,h=!!u;return c||(v=-1<t.selection.indexOf(n),l={click:function(e){h||t.triggerCheckRowEvent(e,r,!v)}},u&&(h=!u({row:n})),a&&(x=-1<d.indexOf(n))),[e("span",{class:["vxe-cell--checkbox",{"is--checked":v,"is--disabled":h,"is--indeterminate":x}],on:l},[e("span",{class:"vxe-checkbox--icon vxe-checkbox--checked-icon"}),e("span",{class:"vxe-checkbox--icon vxe-checkbox--unchecked-icon"}),e("span",{class:"vxe-checkbox--icon vxe-checkbox--indeterminate-icon"})].concat(f&&f.default?t.callSlot(f.default,r,e):s?[e("span",{class:"vxe-checkbox--label"},_ctor.default.get(n,s))]:[]))]},renderTreeSelectionCell:function(e,r){return Cell.renderTreeIcon(e,r,Cell.renderSelectionCell(e,r))},renderSelectionCellByProp:function(e,r){var l,t=r.$table,n=r.row,o=r.column,c=r.isHidden,a=t.treeConfig,d=t.treeIndeterminates,i=t.checkboxOpts,s=i.labelField,u=i.checkField,f=i.halfField,x=i.checkMethod,v=o.slots,h=!1,C=!1,b=!!x;return c||(C=_ctor.default.get(n,u),l={click:function(e){b||t.triggerCheckRowEvent(e,r,!C)}},x&&(b=!x({row:n})),a&&(h=-1<d.indexOf(n))),[e("span",{class:["vxe-cell--checkbox",{"is--checked":C,"is--disabled":b,"is--indeterminate":f&&!C?n[f]:h}],on:l},[e("span",{class:"vxe-checkbox--icon vxe-checkbox--checked-icon"}),e("span",{class:"vxe-checkbox--icon vxe-checkbox--unchecked-icon"}),e("span",{class:"vxe-checkbox--icon vxe-checkbox--indeterminate-icon"})].concat(v&&v.default?t.callSlot(v.default,r,e):s?[e("span",{class:"vxe-checkbox--label"},_ctor.default.get(n,s))]:[]))]},renderTreeSelectionCellByProp:function(e,r){return Cell.renderTreeIcon(e,r,Cell.renderSelectionCellByProp(e,r))},renderExpandCell:function(e,r){var l=r.$table,t=r.isHidden,n=r.row,o=r.column,c=l.expandOpts,a=l.rowExpandeds,d=l.expandLazyLoadeds,i=c.lazy,s=c.labelField,u=c.iconLoaded,f=c.showIcon,x=c.iconOpen,v=c.iconClose,h=c.visibleMethod,C=o.slots,b=!1,p=!1;return C&&C.icon?l.callSlot(C.icon,r,e):(t||(b=-1<a.indexOf(r.row),i&&(p=-1<d.indexOf(n))),[!f||h&&!h(r)?null:e("span",{class:["vxe-table--expanded",{"is--active":b}],on:{click:function(e){l.triggerRowExpandEvent(e,r)}}},[e("i",{class:["vxe-table--expand-btn",p?u||_conf.default.icon.TABLE_EXPAND_LOADED:b?x||_conf.default.icon.TABLE_EXPAND_OPEN:v||_conf.default.icon.TABLE_EXPAND_CLOSE]})]),C&&C.default||s?e("span",{class:"vxe-table--expand-label"},C.default?l.callSlot(C.default,r,e):_ctor.default.get(n,s)):null])},renderExpandData:function(e,r){var l=r.$table,t=r.column,n=t.slots,o=t.contentRender;if(n&&n.content)return l.callSlot(n.content,r,e);if(o){var c=_vXETable.default.renderer.get(o.name);if(c&&c.renderExpand)return c.renderExpand.call(l,e,o,r)}return[]},renderHTMLCell:function(e,r){var l=r.$table,t=r.column.slots;return t&&t.default?l.callSlot(t.default,r,e):[e("span",{class:"vxe-cell--html",domProps:{innerHTML:getDefaultCellLabel(r)}})]},renderTreeHTMLCell:function(e,r){return Cell.renderTreeIcon(e,r,Cell.renderHTMLCell(e,r))},renderSortAndFilterHeader:function(e,r){return Cell.renderDefaultHeader(e,r).concat(Cell.renderSortIcon(e,r)).concat(Cell.renderFilterIcon(e,r))},renderSortHeader:function(e,r){return Cell.renderDefaultHeader(e,r).concat(Cell.renderSortIcon(e,r))},renderSortIcon:function(e,r){var l=r.$table,t=r.column,n=l.sortOpts,o=n.showIcon,c=n.iconAsc,a=n.iconDesc;return o?[e("span",{class:"vxe-cell--sort"},[e("i",{class:["vxe-sort--asc-btn",c||_conf.default.icon.TABLE_SORT_ASC,{"sort--active":"asc"===t.order}],attrs:{title:_conf.default.i18n("vxe.table.sortAsc")},on:{click:function(e){l.triggerSortEvent(e,t,"asc")}}}),e("i",{class:["vxe-sort--desc-btn",a||_conf.default.icon.TABLE_SORT_DESC,{"sort--active":"desc"===t.order}],attrs:{title:_conf.default.i18n("vxe.table.sortDesc")},on:{click:function(e){l.triggerSortEvent(e,t,"desc")}}})])]:[]},renderFilterHeader:function(e,r){return Cell.renderDefaultHeader(e,r).concat(Cell.renderFilterIcon(e,r))},renderFilterIcon:function(e,r){var l=r.$table,t=r.column,n=r.hasFilter,o=l.filterStore,c=l.filterOpts,a=c.showIcon,d=c.iconNone,i=c.iconMatch;return a?[e("span",{class:["vxe-cell--filter",{"is--active":o.visible&&o.column===t}]},[e("i",{class:["vxe-filter--btn",n?i||_conf.default.icon.TABLE_FILTER_MATCH:d||_conf.default.icon.TABLE_FILTER_NONE],attrs:{title:_conf.default.i18n("vxe.table.filter")},on:{click:function(e){l.triggerFilterEvent(e,r.column,r)}}})])]:[]},renderEditHeader:function(e,r){var l,t=r.$table,n=r.column,o=t.editRules,c=t.editOpts,a=n.sortable,d=n.remoteSort,i=n.filters,s=n.editRender;if(o){var u=_ctor.default.get(o,r.column.property);u&&(l=u.some(function(e){return e.required}))}return[l&&c.showAsterisk?e("i",{class:"vxe-cell--required-icon"}):null,(0,_tools.isEnableConf)(s)&&c.showIcon?e("i",{class:["vxe-cell--edit-icon",c.icon||_conf.default.icon.TABLE_EDIT]}):null].concat(Cell.renderDefaultHeader(e,r)).concat(a||d?Cell.renderSortIcon(e,r):[]).concat(i?Cell.renderFilterIcon(e,r):[])},renderRowEdit:function(e,r){var l=r.$table,t=r.column.editRender,n=l.editStore.actived;return Cell.runRenderer(e,r,this,(0,_tools.isEnableConf)(t)&&n&&n.row===r.row)},renderTreeRowEdit:function(e,r){return Cell.renderTreeIcon(e,r,Cell.renderRowEdit(e,r))},renderCellEdit:function(e,r){var l=r.$table,t=r.column.editRender,n=l.editStore.actived;return Cell.runRenderer(e,r,this,(0,_tools.isEnableConf)(t)&&n&&n.row===r.row&&n.column===r.column)},renderTreeCellEdit:function(e,r){return Cell.renderTreeIcon(e,r,Cell.renderCellEdit(e,r))},runRenderer:function(e,r,l,t){var n=r.$table,o=r.column,c=o.slots,a=o.editRender,d=o.formatter,i=_vXETable.default.renderer.get(a.name);return t?c&&c.edit?n.callSlot(c.edit,r,e):i&&i.renderEdit?i.renderEdit.call(n,e,a,Object.assign({$type:"edit"},r)):[]:c&&c.default?n.callSlot(c.default,r,e):d?[e("span",{class:"vxe-cell--label"},[getDefaultCellLabel(r)])]:Cell.renderDefaultCell.call(l,e,r)}},_default=exports.Cell=Cell;exports.default=_default;