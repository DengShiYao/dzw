"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var autoTxtElem,_ctor=_interopRequireDefault(require("xe-utils/ctor")),_conf=_interopRequireDefault(require("../../conf")),_size=_interopRequireDefault(require("../../mixins/size")),_tools=require("../../tools");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _defineProperty(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var _default2={name:"VxeTextarea",mixins:[_size.default],model:{prop:"value",event:"modelValue"},props:{value:[String,Number],immediate:{type:Boolean,default:!0},name:String,readonly:Boolean,disabled:Boolean,placeholder:String,maxlength:[String,Number],rows:{type:[String,Number],default:2},showWordCount:Boolean,autosize:[Boolean,Object],form:String,resize:{type:String,default:function(){return _conf.default.textarea.resize}},size:{type:String,default:function(){return _conf.default.textarea.size||_conf.default.size}}},data:function(){return{inputValue:this.value}},computed:{inputCount:function(){return _ctor.default.getSize(this.inputValue)},isCountError:function(){return this.maxlength&&this.inputCount>_ctor.default.toNumber(this.maxlength)},defaultEvents:function(){var i=this,n={};return _ctor.default.each(this.$listeners,function(t,e){-1===["input","change","blur"].indexOf(e)&&(n[e]=i.triggerEvent)}),n.input=this.inputEvent,n.change=this.changeEvent,n.blur=this.blurEvent,n},sizeOpts:function(){return Object.assign({minRows:1,maxRows:10},_conf.default.textarea.autosize,this.autosize)}},watch:{value:function(t){this.inputValue=t,this.updateAutoTxt()}},mounted:function(){this.inputValue&&(this.updateAutoTxt(),this.handleResize())},render:function(t){var e,i=this.defaultEvents,n=this.inputValue,a=this.vSize,u=this.name,r=this.form,o=this.resize,s=this.placeholder,l=this.readonly,d=this.disabled,h=this.maxlength,c=this.autosize,f=this.showWordCount,p={name:u,form:r,placeholder:s,maxlength:h,readonly:l,disabled:d};return s&&(p.placeholder=_tools.UtilTools.getFuncText(s)),t("div",{class:["vxe-textarea",(e={},_defineProperty(e,"size--".concat(a),a),_defineProperty(e,"is--autosize",c),_defineProperty(e,"is--disabled",d),e)]},[t("textarea",{ref:"textarea",class:"vxe-textarea--inner",domProps:{value:n},attrs:p,style:o?{resize:o}:null,on:i}),f?t("span",{class:["vxe-textarea--count",{"is--error":this.isCountError}]},"".concat(this.inputCount).concat(h?"/".concat(h):"")):null])},methods:{focus:function(){return this.$refs.textarea.focus(),this.$nextTick()},blur:function(){return this.$refs.textarea.blur(),this.$nextTick()},triggerEvent:function(t){var e=this.inputValue;this.$emit(t.type,{value:e,$event:t})},emitUpdate:function(t,e){this.inputValue=t,this.$emit("modelValue",t),this.value!==t&&this.$emit("change",{value:t,$event:e})},inputEvent:function(t){var e=this.immediate,i=t.target.value;this.inputValue=i,e&&this.emitUpdate(i,t),this.handleResize(),this.triggerEvent(t)},changeEvent:function(t){this.immediate?this.triggerEvent(t):this.emitUpdate(this.inputValue,t)},blurEvent:function(t){var e=this.inputValue;this.immediate||this.emitUpdate(e,t),this.$emit("blur",{value:e,$event:t})},updateAutoTxt:function(){var t=this.$refs,e=this.inputValue,i=this.size;if(this.autosize){autoTxtElem||(autoTxtElem=document.createElement("div")),autoTxtElem.parentNode||document.body.appendChild(autoTxtElem);var n=t.textarea,a=getComputedStyle(n);autoTxtElem.className=["vxe-textarea--autosize",i?"size--".concat(i):""].join(" "),autoTxtElem.style.width="".concat(n.clientWidth,"px"),autoTxtElem.style.padding=a.padding,autoTxtElem.innerHTML=(""+(e||"　")).replace(/\n$/,"\n　")}},handleResize:function(){var c=this;this.autosize&&this.$nextTick(function(){var t=c.$refs,e=c.sizeOpts,i=e.minRows,n=e.maxRows,a=t.textarea,u=autoTxtElem.clientHeight,r=getComputedStyle(a),o=_ctor.default.toNumber(r.lineHeight),s=_ctor.default.toNumber(r.paddingTop)+_ctor.default.toNumber(r.paddingBottom)+_ctor.default.toNumber(r.borderTopWidth)+_ctor.default.toNumber(r.borderBottomWidth),l=(u-s)/o,d=l&&/[0-9]/.test(l)?l:Math.floor(l)+1,h=d;d<i?h=i:n<d&&(h=n),a.style.height="".concat(h*o+s,"px")})}}};exports.default=_default2;