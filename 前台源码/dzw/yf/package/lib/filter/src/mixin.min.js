"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _ctor=_interopRequireDefault(require("xe-utils/ctor")),_tools=require("../../tools"),_util=require("../../table/src/util"),_vXETable=_interopRequireDefault(require("../../v-x-e-table"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default={methods:{_setFilter:function(e,t){var i=(0,_util.handleFieldOrColumn)(this,e);return i&&i.filters&&t&&(i.filters=_tools.UtilTools.getFilters(t)),this.$nextTick()},checkFilterOptions:function(){var e=this.filterStore;e.isAllSelected=e.options.every(function(e){return e._checked}),e.isIndeterminate=!e.isAllSelected&&e.options.some(function(e){return e._checked})},triggerFilterEvent:function(e,a,t){var c=this,u=this.filterStore;if(u.column===a&&u.visible)u.visible=!1;else{var h=e.target,d=e.pageX,p=_tools.DomTools.getDomNode().visibleWidth;Object.assign(u,{args:t,multiple:a.filterMultiple,options:a.filters,column:a,style:null,visible:!0}),u.options.forEach(function(e){e._checked=e.checked}),this.checkFilterOptions(),this.initStore.filter=!0,this.$nextTick(function(){var e,t,i=c.$refs,l=i.tableBody.$el,r=i.filterWrapper.$el.offsetWidth,o=r/2,s={top:"".concat(h.offsetTop+h.offsetParent.offsetTop+h.offsetHeight+8,"px")};if("left"===a.fixed?e=h.offsetLeft+h.offsetParent.offsetLeft-o:"right"===a.fixed?t=h.offsetParent.offsetWidth-h.offsetLeft+(h.offsetParent.offsetParent.offsetWidth-h.offsetParent.offsetLeft)-a.renderWidth-o:e=h.offsetLeft+h.offsetParent.offsetLeft-o-l.scrollLeft,e){var n=d+r-o+32-p;0<n&&(e-=n),s.left="".concat(Math.max(32,e),"px")}else if(t){var f=d+r-o+32-p;0<f&&(t+=f),s.right="".concat(t,"px")}u.style=s})}},_getCheckedFilters:function(){var e=this.visibleColumn,o=[];return e.filter(function(e){var t=e.property,i=e.filters,l=[],r=[];i&&i.length&&(i.forEach(function(e){e.checked&&(l.push(e.value),r.push(e.data))}),l.length&&o.push({column:e,property:t,values:l,datas:r}))}),o},confirmFilterEvent:function(e){var t=this,i=this.filterStore,l=this.filterOpts,r=this.scrollXLoad,o=this.scrollYLoad,s=i.column,n=s.property,f=[],a=[];s.filters.forEach(function(e){e.checked&&(f.push(e.value),a.push(e.data))}),i.visible=!1;var c=this.getCheckedFilters();l.remote||(this.handleTableData(!0),this.checkSelectionStatus()),this.emitEvent("filter-change",{column:s,property:n,values:f,datas:a,filters:c,filterList:c},e),this.updateFooter(),(r||o)&&(this.clearScroll(),o&&this.updateScrollYSpace()),this.closeFilter(),this.$nextTick(function(){t.recalculate(),t.updateCellAreas()})},handleClearFilter:function(e){if(e){var t=e.filters,i=e.filterRender;if(t){var l=i?_vXETable.default.renderer.get(i.name):null,r=l?l.filterResetMethod:null;t.forEach(function(e){e._checked=!1,e.checked=!1,r||(e.data=_ctor.default.clone(e.resetValue,!0))}),r&&r({options:t,column:e,$table:this})}}},resetFilterEvent:function(e){this.handleClearFilter(this.filterStore.column),this.confirmFilterEvent(e)},_clearFilter:function(e){var t,i=this.filterStore;return e?(t=(0,_util.handleFieldOrColumn)(this,e))&&this.handleClearFilter(t):this.visibleColumn.forEach(this.handleClearFilter),e&&t===i.column||Object.assign(i,{isAllSelected:!1,isIndeterminate:!1,style:null,options:[],column:null,multiple:!1,visible:!1}),this.updateData()}}};exports.default=_default;